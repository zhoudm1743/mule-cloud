# Mule-Cloud æ¶æ„è¯´æ˜æ–‡æ¡£

## ğŸ“– ç›®å½•
- [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
- [ä¸‰å±‚æ¶æ„è¯¦è§£](#ä¸‰å±‚æ¶æ„è¯¦è§£)
- [æ˜¯å¦æ¯ä¸ªæ¥å£éƒ½éœ€è¦ä¸€ä¸ªEndpointï¼Ÿ](#æ˜¯å¦æ¯ä¸ªæ¥å£éƒ½éœ€è¦ä¸€ä¸ªendpoint)
- [å¿«é€Ÿå¼€å§‹ï¼šæ·»åŠ æ–°æ¥å£](#å¿«é€Ÿå¼€å§‹æ·»åŠ æ–°æ¥å£)
- [å®Œæ•´ç¤ºä¾‹](#å®Œæ•´ç¤ºä¾‹)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¶æ„æ¦‚è¿°

æœ¬é¡¹ç›®é‡‡ç”¨ **Go-Kit å¾®æœåŠ¡æ¡†æ¶** + **Gin HTTPæ¡†æ¶** çš„åˆ†å±‚æ¶æ„æ¨¡å¼ï¼Œéµå¾ªä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         HTTPè¯·æ±‚ (Gin Router)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Transport Layer (ä¼ è¾“å±‚)              â”‚
â”‚   - å‚æ•°ç»‘å®šä¸éªŒè¯                      â”‚
â”‚   - HTTPè¯·æ±‚/å“åº”å¤„ç†                   â”‚
â”‚   - è°ƒç”¨Endpointå±‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Endpoint Layer (ç«¯ç‚¹å±‚)               â”‚
â”‚   - è¯·æ±‚/å“åº”ç±»å‹è½¬æ¢                   â”‚
â”‚   - è°ƒç”¨Serviceå±‚                       â”‚
â”‚   - Go-Kitæ ‡å‡†æ¥å£                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Service Layer (æœåŠ¡å±‚)                â”‚
â”‚   - ä¸šåŠ¡é€»è¾‘å®ç°                        â”‚
â”‚   - æ•°æ®å¤„ç†                            â”‚
â”‚   - è¿”å›ç»“æœ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰å±‚æ¶æ„è¯¦è§£

### 1ï¸âƒ£ Service Layer (æœåŠ¡å±‚)
**ä½ç½®**: `services/`

**èŒè´£**:
- å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- ä¸å…³å¿ƒHTTPåè®®ç»†èŠ‚
- å¯ä»¥è¢«å¤šç§ä¼ è¾“å±‚å¤ç”¨ (HTTP, gRPC, etc.)

**ç¤ºä¾‹**:
```go
// services/admin.go
package services

type IAdminService interface {
    Get(id string) (interface{}, error)
}

type AdminService struct{}

func (s *AdminService) Get(id string) (interface{}, error) {
    // ä¸šåŠ¡é€»è¾‘å®ç°
    return id, nil
}

func NewAdminService() IAdminService {
    return &AdminService{}
}
```

### 2ï¸âƒ£ Endpoint Layer (ç«¯ç‚¹å±‚)
**ä½ç½®**: `endpoint/`

**èŒè´£**:
- å®šä¹‰è¯·æ±‚/å“åº”ç»“æ„ä½“
- å°†HTTPå±‚çš„æ•°æ®è½¬æ¢ä¸ºServiceå±‚çš„å‚æ•°
- éµå¾ªGo-Kitçš„ `endpoint.Endpoint` æ¥å£

**ç¤ºä¾‹**:
```go
// endpoint/admin.go
package endpoint

import (
    "context"
    "github.com/go-kit/kit/endpoint"
)

// è¯·æ±‚ç»“æ„
type AdminRequest struct {
    Id string `json:"id" form:"id" binding"required"`
}

// å“åº”ç»“æ„
type AdminResponse struct {
    Result string `json:"result"`
}

// Endpointå‡½æ•°
func GetAdminEndpoint(svc services.IAdminService) endpoint.Endpoint {
    return func(ctx context.Context, request interface{}) (interface{}, error) {
        req := request.(AdminRequest)
        res, err := svc.Get(req.Id)
        if err != nil {
            return nil, err
        }
        return AdminResponse{Result: res.(string)}, nil
    }
}
```

### 3ï¸âƒ£ Transport Layer (ä¼ è¾“å±‚)
**ä½ç½®**: `transport/`

**èŒè´£**:
- å¤„ç†HTTPè¯·æ±‚ç»‘å®š
- å‚æ•°éªŒè¯
- è°ƒç”¨Endpoint
- ç»Ÿä¸€å“åº”æ ¼å¼

**ç¤ºä¾‹**:
```go
// transport/admin.go
package transport

func AdminGetHandler(svc services.IAdminService) gin.HandlerFunc {
    return func(c *gin.Context) {
        // 1. å‚æ•°ç»‘å®š
        var req endpoint.AdminRequest
        if err := c.ShouldBindQuery(&req); err != nil {
            response.Error(c, "å‚æ•°é”™è¯¯: "+err.Error())
            return
        }

        // 2. å‚æ•°æ ¡éªŒ
        if req.Id == "" {
            response.Error(c, "idä¸èƒ½ä¸ºç©º")
            return
        }

        // 3. è°ƒç”¨endpoint
        ep := endpoint.GetAdminEndpoint(svc)
        resp, err := ep(c.Request.Context(), req)
        if err != nil {
            response.Error(c, err.Error())
            return
        }

        // 4. è¿”å›å“åº”
        response.Success(c, resp)
    }
}
```

---

## æ˜¯å¦æ¯ä¸ªæ¥å£éƒ½éœ€è¦ä¸€ä¸ªEndpointï¼Ÿ

### âœ… æ ‡å‡†ç­”æ¡ˆï¼šæ˜¯çš„

**åœ¨æ ‡å‡†çš„Go-Kitæ¶æ„ä¸­ï¼Œæ¯ä¸ªæ¥å£ï¼ˆAPIï¼‰éƒ½åº”è¯¥æœ‰ä¸€ä¸ªå¯¹åº”çš„Endpointå‡½æ•°ã€‚**

### ğŸ¤” ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

1. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**: æ¯ä¸ªEndpointä¸“æ³¨äºä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡æ“ä½œ
2. **ç±»å‹å®‰å…¨**: æ¯ä¸ªæ“ä½œæœ‰æ˜ç¡®çš„è¯·æ±‚/å“åº”ç±»å‹
3. **å¯æµ‹è¯•æ€§**: æ¯ä¸ªEndpointå¯ä»¥ç‹¬ç«‹æµ‹è¯•
4. **å¯ç»´æŠ¤æ€§**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
5. **å¯æ‰©å±•æ€§**: æ–¹ä¾¿åç»­æ·»åŠ ä¸­é—´ä»¶ï¼ˆæ—¥å¿—ã€ç›‘æ§ã€é‰´æƒç­‰ï¼‰

### ğŸ’¡ ä½†æ˜¯å¯ä»¥ä¼˜åŒ–ï¼

è™½ç„¶æ¯ä¸ªæ¥å£éœ€è¦ä¸€ä¸ªEndpointï¼Œä½†**åŒä¸€ä¸ªæœåŠ¡çš„å¤šä¸ªæ¥å£å¯ä»¥æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­**ï¼š

```go
// endpoint/admin.go
package endpoint

// AdminæœåŠ¡çš„æ‰€æœ‰Endpointéƒ½åœ¨è¿™ä¸ªæ–‡ä»¶

// GET /admin
func GetAdminEndpoint(svc services.IAdminService) endpoint.Endpoint {
    return func(ctx context.Context, request interface{}) (interface{}, error) {
        // ...
    }
}

// POST /admin
func CreateAdminEndpoint(svc services.IAdminService) endpoint.Endpoint {
    return func(ctx context.Context, request interface{}) (interface{}, error) {
        // ...
    }
}

// PUT /admin/:id
func UpdateAdminEndpoint(svc services.IAdminService) endpoint.Endpoint {
    return func(ctx context.Context, request interface{}) (interface{}, error) {
        // ...
    }
}

// DELETE /admin/:id
func DeleteAdminEndpoint(svc services.IAdminService) endpoint.Endpoint {
    return func(ctx context.Context, request interface{}) (interface{}, error) {
        // ...
    }
}
```

---

## å¿«é€Ÿå¼€å§‹ï¼šæ·»åŠ æ–°æ¥å£

### åœºæ™¯ï¼šæ·»åŠ ä¸€ä¸ªç”¨æˆ·ç®¡ç†æ¨¡å—çš„ `GET /user/:id` æ¥å£

#### æ­¥éª¤ 1: åˆ›å»º Service å±‚

```bash
åˆ›å»ºæ–‡ä»¶: services/user.go
```

```go
package services

type IUserService interface {
    GetById(id string) (*User, error)
}

type UserService struct {
    // å¯ä»¥æ³¨å…¥æ•°æ®åº“è¿æ¥ç­‰ä¾èµ–
}

type User struct {
    Id   string `json:"id"`
    Name string `json:"name"`
    Age  int    `json:"age"`
}

func (s *UserService) GetById(id string) (*User, error) {
    // å®é™…ä¸šåŠ¡é€»è¾‘ï¼šä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·
    return &User{
        Id:   id,
        Name: "å¼ ä¸‰",
        Age:  25,
    }, nil
}

func NewUserService() IUserService {
    return &UserService{}
}
```

#### æ­¥éª¤ 2: åˆ›å»º Endpoint å±‚

```bash
åˆ›å»ºæ–‡ä»¶: endpoint/user.go
```

```go
package endpoint

import (
    "context"
    "mule-cloud/test/services"
    "github.com/go-kit/kit/endpoint"
)

// è¯·æ±‚ç»“æ„
type GetUserRequest struct {
    Id string `json:"id" uri:"id" binding"required"`
}

// å“åº”ç»“æ„
type GetUserResponse struct {
    User *services.User `json:"user"`
}

// Endpointå‡½æ•°
func GetUserEndpoint(svc services.IUserService) endpoint.Endpoint {
    return func(ctx context.Context, request interface{}) (interface{}, error) {
        req := request.(GetUserRequest)
        user, err := svc.GetById(req.Id)
        if err != nil {
            return nil, err
        }
        return GetUserResponse{User: user}, nil
    }
}
```

#### æ­¥éª¤ 3: åˆ›å»º Transport å±‚

```bash
åˆ›å»ºæ–‡ä»¶: transport/user.go
```

```go
package transport

import (
    "mule-cloud/core/response"
    "mule-cloud/test/endpoint"
    "mule-cloud/test/services"
    "github.com/gin-gonic/gin"
)

func UserGetByIdHandler(svc services.IUserService) gin.HandlerFunc {
    return func(c *gin.Context) {
        // 1. å‚æ•°ç»‘å®š
        var req endpoint.GetUserRequest
        if err := c.ShouldBindUri(&req); err != nil {
            response.Error(c, "å‚æ•°é”™è¯¯: "+err.Error())
            return
        }

        // 2. è°ƒç”¨endpoint
        ep := endpoint.GetUserEndpoint(svc)
        resp, err := ep(c.Request.Context(), req)
        if err != nil {
            response.Error(c, err.Error())
            return
        }

        // 3. è¿”å›å“åº”
        response.Success(c, resp)
    }
}
```

#### æ­¥éª¤ 4: æ³¨å†Œè·¯ç”±

```bash
ä¿®æ”¹æ–‡ä»¶: cmd/main.go
```

```go
package main

import (
    "mule-cloud/test/services"
    "mule-cloud/test/transport"
    "github.com/gin-gonic/gin"
)

func main() {
    // åˆå§‹åŒ–æœåŠ¡
    adminSvc := services.NewAdminService()
    userSvc := services.NewUserService()  // æ–°å¢

    // åˆå§‹åŒ–è·¯ç”±
    r := gin.Default()

    // Adminè·¯ç”±ç»„
    admin := r.Group("/admin")
    {
        admin.GET("/", transport.AdminGetHandler(adminSvc))
    }

    // Userè·¯ç”±ç»„ (æ–°å¢)
    user := r.Group("/user")
    {
        user.GET("/:id", transport.UserGetByIdHandler(userSvc))
    }

    // å¯åŠ¨æœåŠ¡
    r.Run(":8080")
}
```

#### âœ… å®Œæˆï¼æµ‹è¯•æ¥å£

```bash
curl http://localhost:8080/user/123
```

---

## å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹ï¼šå®ç°å®Œæ•´çš„ CRUD æ“ä½œ

#### 1. Service å±‚ (services/product.go)

```go
package services

type IProductService interface {
    List() ([]*Product, error)
    GetById(id string) (*Product, error)
    Create(name string, price float64) (*Product, error)
    Update(id, name string, price float64) error
    Delete(id string) error
}

type Product struct {
    Id    string  `json:"id"`
    Name  string  `json:"name"`
    Price float64 `json:"price"`
}

type ProductService struct {
    // å†…å­˜å­˜å‚¨ï¼ˆå®é™…åº”ä½¿ç”¨æ•°æ®åº“ï¼‰
    products map[string]*Product
}

func NewProductService() IProductService {
    return &ProductService{
        products: make(map[string]*Product),
    }
}

func (s *ProductService) List() ([]*Product, error) {
    list := make([]*Product, 0, len(s.products))
    for _, p := range s.products {
        list = append(list, p)
    }
    return list, nil
}

func (s *ProductService) GetById(id string) (*Product, error) {
    if p, ok := s.products[id]; ok {
        return p, nil
    }
    return nil, fmt.Errorf("äº§å“ä¸å­˜åœ¨")
}

func (s *ProductService) Create(name string, price float64) (*Product, error) {
    id := fmt.Sprintf("P%d", time.Now().Unix())
    p := &Product{Id: id, Name: name, Price: price}
    s.products[id] = p
    return p, nil
}

func (s *ProductService) Update(id, name string, price float64) error {
    if p, ok := s.products[id]; ok {
        p.Name = name
        p.Price = price
        return nil
    }
    return fmt.Errorf("äº§å“ä¸å­˜åœ¨")
}

func (s *ProductService) Delete(id string) error {
    if _, ok := s.products[id]; ok {
        delete(s.products, id)
        return nil
    }
    return fmt.Errorf("äº§å“ä¸å­˜åœ¨")
}
```

#### 2. Endpoint å±‚ (endpoint/product.go)

```go
package endpoint

import (
    "context"
    "mule-cloud/test/services"
    "github.com/go-kit/kit/endpoint"
)

// ===== List =====
type ListProductRequest struct{}

type ListProductResponse struct {
    Products []*services.Product `json:"products"`
}

func ListProductEndpoint(svc services.IProductService) endpoint.Endpoint {
    return func(ctx context.Context, request interface{}) (interface{}, error) {
        products, err := svc.List()
        if err != nil {
            return nil, err
        }
        return ListProductResponse{Products: products}, nil
    }
}

// ===== Get =====
type GetProductRequest struct {
    Id string `uri:"id" binding"required"`
}

type GetProductResponse struct {
    Product *services.Product `json:"product"`
}

func GetProductEndpoint(svc services.IProductService) endpoint.Endpoint {
    return func(ctx context.Context, request interface{}) (interface{}, error) {
        req := request.(GetProductRequest)
        product, err := svc.GetById(req.Id)
        if err != nil {
            return nil, err
        }
        return GetProductResponse{Product: product}, nil
    }
}

// ===== Create =====
type CreateProductRequest struct {
    Name  string  `json:"name" binding"required"`
    Price float64 `json:"price" binding"required"`
}

type CreateProductResponse struct {
    Product *services.Product `json:"product"`
}

func CreateProductEndpoint(svc services.IProductService) endpoint.Endpoint {
    return func(ctx context.Context, request interface{}) (interface{}, error) {
        req := request.(CreateProductRequest)
        product, err := svc.Create(req.Name, req.Price)
        if err != nil {
            return nil, err
        }
        return CreateProductResponse{Product: product}, nil
    }
}

// ===== Update =====
type UpdateProductRequest struct {
    Id    string  `uri:"id" binding"required"`
    Name  string  `json:"name" binding"required"`
    Price float64 `json:"price" binding"required"`
}

type UpdateProductResponse struct {
    Message string `json:"message"`
}

func UpdateProductEndpoint(svc services.IProductService) endpoint.Endpoint {
    return func(ctx context.Context, request interface{}) (interface{}, error) {
        req := request.(UpdateProductRequest)
        err := svc.Update(req.Id, req.Name, req.Price)
        if err != nil {
            return nil, err
        }
        return UpdateProductResponse{Message: "æ›´æ–°æˆåŠŸ"}, nil
    }
}

// ===== Delete =====
type DeleteProductRequest struct {
    Id string `uri:"id" binding"required"`
}

type DeleteProductResponse struct {
    Message string `json:"message"`
}

func DeleteProductEndpoint(svc services.IProductService) endpoint.Endpoint {
    return func(ctx context.Context, request interface{}) (interface{}, error) {
        req := request.(DeleteProductRequest)
        err := svc.Delete(req.Id)
        if err != nil {
            return nil, err
        }
        return DeleteProductResponse{Message: "åˆ é™¤æˆåŠŸ"}, nil
    }
}
```

#### 3. Transport å±‚ (transport/product.go)

```go
package transport

import (
    "mule-cloud/core/response"
    "mule-cloud/test/endpoint"
    "mule-cloud/test/services"
    "github.com/gin-gonic/gin"
)

// GET /product
func ProductListHandler(svc services.IProductService) gin.HandlerFunc {
    return func(c *gin.Context) {
        ep := endpoint.ListProductEndpoint(svc)
        resp, err := ep(c.Request.Context(), endpoint.ListProductRequest{})
        if err != nil {
            response.Error(c, err.Error())
            return
        }
        response.Success(c, resp)
    }
}

// GET /product/:id
func ProductGetHandler(svc services.IProductService) gin.HandlerFunc {
    return func(c *gin.Context) {
        var req endpoint.GetProductRequest
        if err := c.ShouldBindUri(&req); err != nil {
            response.Error(c, "å‚æ•°é”™è¯¯: "+err.Error())
            return
        }

        ep := endpoint.GetProductEndpoint(svc)
        resp, err := ep(c.Request.Context(), req)
        if err != nil {
            response.Error(c, err.Error())
            return
        }
        response.Success(c, resp)
    }
}

// POST /product
func ProductCreateHandler(svc services.IProductService) gin.HandlerFunc {
    return func(c *gin.Context) {
        var req endpoint.CreateProductRequest
        if err := c.ShouldBindJSON(&req); err != nil {
            response.Error(c, "å‚æ•°é”™è¯¯: "+err.Error())
            return
        }

        ep := endpoint.CreateProductEndpoint(svc)
        resp, err := ep(c.Request.Context(), req)
        if err != nil {
            response.Error(c, err.Error())
            return
        }
        response.Success(c, resp)
    }
}

// PUT /product/:id
func ProductUpdateHandler(svc services.IProductService) gin.HandlerFunc {
    return func(c *gin.Context) {
        var req endpoint.UpdateProductRequest
        if err := c.ShouldBindUri(&req); err != nil {
            response.Error(c, "å‚æ•°é”™è¯¯: "+err.Error())
            return
        }
        if err := c.ShouldBindJSON(&req); err != nil {
            response.Error(c, "å‚æ•°é”™è¯¯: "+err.Error())
            return
        }

        ep := endpoint.UpdateProductEndpoint(svc)
        resp, err := ep(c.Request.Context(), req)
        if err != nil {
            response.Error(c, err.Error())
            return
        }
        response.Success(c, resp)
    }
}

// DELETE /product/:id
func ProductDeleteHandler(svc services.IProductService) gin.HandlerFunc {
    return func(c *gin.Context) {
        var req endpoint.DeleteProductRequest
        if err := c.ShouldBindUri(&req); err != nil {
            response.Error(c, "å‚æ•°é”™è¯¯: "+err.Error())
            return
        }

        ep := endpoint.DeleteProductEndpoint(svc)
        resp, err := ep(c.Request.Context(), req)
        if err != nil {
            response.Error(c, err.Error())
            return
        }
        response.Success(c, resp)
    }
}
```

#### 4. æ³¨å†Œè·¯ç”±

```go
package main

func main() {
    productSvc := services.NewProductService()
    
    r := gin.Default()
    
    product := r.Group("/product")
    {
        product.GET("", transport.ProductListHandler(productSvc))
        product.GET("/:id", transport.ProductGetHandler(productSvc))
        product.POST("", transport.ProductCreateHandler(productSvc))
        product.PUT("/:id", transport.ProductUpdateHandler(productSvc))
        product.DELETE("/:id", transport.ProductDeleteHandler(productSvc))
    }
    
    r.Run(":8080")
}
```

---

## æœ€ä½³å®è·µ

### 1. æ–‡ä»¶ç»„ç»‡å»ºè®®

```
project/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go              # ç¨‹åºå…¥å£
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ admin.go             # AdminæœåŠ¡
â”‚   â”œâ”€â”€ user.go              # UseræœåŠ¡
â”‚   â””â”€â”€ product.go           # ProductæœåŠ¡
â”œâ”€â”€ endpoint/
â”‚   â”œâ”€â”€ admin.go             # Adminæ‰€æœ‰endpoint
â”‚   â”œâ”€â”€ user.go              # Useræ‰€æœ‰endpoint
â”‚   â””â”€â”€ product.go           # Productæ‰€æœ‰endpoint
â”œâ”€â”€ transport/
â”‚   â”œâ”€â”€ admin.go             # Adminæ‰€æœ‰handler
â”‚   â”œâ”€â”€ user.go              # Useræ‰€æœ‰handler
â”‚   â””â”€â”€ product.go           # Productæ‰€æœ‰handler
â””â”€â”€ core/
    â””â”€â”€ response/
        â””â”€â”€ response.go      # ç»Ÿä¸€å“åº”
```

### 2. å‘½åè§„èŒƒ

- **Serviceæ¥å£**: `I{æ¨¡å—}Service`ï¼Œå¦‚ `IUserService`
- **Serviceå®ç°**: `{æ¨¡å—}Service`ï¼Œå¦‚ `UserService`
- **Endpointå‡½æ•°**: `{æ“ä½œ}{æ¨¡å—}Endpoint`ï¼Œå¦‚ `GetUserEndpoint`
- **Transportå‡½æ•°**: `{æ¨¡å—}{æ“ä½œ}Handler`ï¼Œå¦‚ `UserGetHandler`
- **Requestç»“æ„**: `{æ“ä½œ}{æ¨¡å—}Request`ï¼Œå¦‚ `GetUserRequest`
- **Responseç»“æ„**: `{æ“ä½œ}{æ¨¡å—}Response`ï¼Œå¦‚ `GetUserResponse`

### 3. å‚æ•°ç»‘å®šæ–¹å¼

| ç»‘å®šæ–¹å¼ | ä½¿ç”¨åœºæ™¯ | Tag | Ginæ–¹æ³• |
|---------|---------|-----|---------|
| Queryå‚æ•° | `?id=123` | `form:"id"` | `ShouldBindQuery` |
| URIå‚æ•° | `/:id` | `uri:"id"` | `ShouldBindUri` |
| JSON Body | POST/PUTè¯·æ±‚ä½“ | `json:"name"` | `ShouldBindJSON` |
| Formè¡¨å• | è¡¨å•æäº¤ | `form:"name"` | `ShouldBind` |

### 4. é”™è¯¯å¤„ç†

å»ºè®®åœ¨ `core/response` ä¸­æ‰©å±•é”™è¯¯å¤„ç†ï¼š

```go
// response/response.go
package response

import (
    "net/http"
    "github.com/gin-gonic/gin"
)

// é”™è¯¯ç å®šä¹‰
const (
    CodeSuccess      = 0
    CodeParamError   = 1001
    CodeNotFound     = 1002
    CodeServerError  = 1003
    CodeUnauthorized = 1004
)

type Response struct {
    Code int         `json:"code"`
    Msg  string      `json:"msg"`
    Data interface{} `json:"data,omitempty"`
}

func Success(c *gin.Context, data interface{}) {
    c.JSON(http.StatusOK, Response{
        Code: CodeSuccess,
        Msg:  "success",
        Data: data,
    })
}

func Error(c *gin.Context, msg string) {
    c.JSON(http.StatusOK, Response{
        Code: CodeServerError,
        Msg:  msg,
    })
}

func ErrorWithCode(c *gin.Context, code int, msg string) {
    c.JSON(http.StatusOK, Response{
        Code: code,
        Msg:  msg,
    })
}

func ParamError(c *gin.Context, msg string) {
    c.JSON(http.StatusOK, Response{
        Code: CodeParamError,
        Msg:  msg,
    })
}

func NotFound(c *gin.Context, msg string) {
    c.JSON(http.StatusOK, Response{
        Code: CodeNotFound,
        Msg:  msg,
    })
}
```

### 5. æ·»åŠ ä¸­é—´ä»¶æ”¯æŒ

Endpointå±‚å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ·»åŠ ä¸­é—´ä»¶ï¼ˆæ—¥å¿—ã€ç›‘æ§ã€é‰´æƒç­‰ï¼‰ï¼š

```go
// endpoint/middleware.go
package endpoint

import (
    "context"
    "log"
    "time"
    "github.com/go-kit/kit/endpoint"
)

// æ—¥å¿—ä¸­é—´ä»¶
func LoggingMiddleware(logger *log.Logger) endpoint.Middleware {
    return func(next endpoint.Endpoint) endpoint.Endpoint {
        return func(ctx context.Context, request interface{}) (interface{}, error) {
            start := time.Now()
            logger.Printf("å¼€å§‹å¤„ç†è¯·æ±‚: %+v", request)
            
            response, err := next(ctx, request)
            
            logger.Printf("è¯·æ±‚å¤„ç†å®Œæˆï¼Œè€—æ—¶: %v, é”™è¯¯: %v", time.Since(start), err)
            return response, err
        }
    }
}

// é‰´æƒä¸­é—´ä»¶
func AuthMiddleware(requiredRole string) endpoint.Middleware {
    return func(next endpoint.Endpoint) endpoint.Endpoint {
        return func(ctx context.Context, request interface{}) (interface{}, error) {
            // ä»contextä¸­è·å–ç”¨æˆ·ä¿¡æ¯
            userRole := ctx.Value("user_role").(string)
            if userRole != requiredRole {
                return nil, fmt.Errorf("æƒé™ä¸è¶³")
            }
            return next(ctx, request)
        }
    }
}

// ä½¿ç”¨ä¸­é—´ä»¶
func GetAdminEndpoint(svc services.IAdminService) endpoint.Endpoint {
    ep := makeGetAdminEndpoint(svc)
    ep = LoggingMiddleware(logger)(ep)
    ep = AuthMiddleware("admin")(ep)
    return ep
}
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¦ç”¨ä¸‰å±‚æ¶æ„ï¼Ÿç›´æ¥åœ¨Handleré‡Œå†™ä¸šåŠ¡é€»è¾‘ä¸è¡Œå—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†ä¸æ¨èã€‚ä¸‰å±‚æ¶æ„çš„ä¼˜åŠ¿ï¼š
- **å¯æµ‹è¯•æ€§**: Serviceå±‚å¯ä»¥å•ç‹¬æµ‹è¯•ï¼Œä¸éœ€è¦å¯åŠ¨HTTPæœåŠ¡
- **å¯å¤ç”¨æ€§**: åŒä¸€ä¸ªServiceå¯ä»¥è¢«HTTPã€gRPCã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰å¤šç§ä¼ è¾“å±‚ä½¿ç”¨
- **å¯ç»´æŠ¤æ€§**: èŒè´£æ¸…æ™°ï¼Œä¿®æ”¹æ›´å®‰å…¨
- **å¯æ‰©å±•æ€§**: æ–¹ä¾¿æ·»åŠ ä¸­é—´ä»¶ã€ç›‘æ§ç­‰

### Q2: ç®€å•çš„CRUDæ“ä½œä¹Ÿéœ€è¦è¿™ä¹ˆå¤æ‚å—ï¼Ÿ

**A**: æ ¹æ®é¡¹ç›®è§„æ¨¡é€‰æ‹©ï¼š
- **å°å‹é¡¹ç›®/åŸå‹**: å¯ä»¥ç®€åŒ–ï¼ŒTransportç›´æ¥è°ƒç”¨Service
- **ä¸­å¤§å‹é¡¹ç›®**: å»ºè®®å®Œæ•´ä½¿ç”¨ï¼Œä¾¿äºåæœŸç»´æŠ¤å’Œæ‰©å±•

### Q3: å¦‚ä½•å‡å°‘é‡å¤ä»£ç ï¼Ÿ

**A**: å¯ä»¥ä½¿ç”¨ä»£ç ç”Ÿæˆå·¥å…·ï¼Œæˆ–è€…å°è£…é€šç”¨çš„Handlerï¼š

```go
// transport/common.go
func MakeHandler(ep endpoint.Endpoint, bindFunc func(*gin.Context) (interface{}, error)) gin.HandlerFunc {
    return func(c *gin.Context) {
        req, err := bindFunc(c)
        if err != nil {
            response.ParamError(c, err.Error())
            return
        }
        
        resp, err := ep(c.Request.Context(), req)
        if err != nil {
            response.Error(c, err.Error())
            return
        }
        
        response.Success(c, resp)
    }
}

// ä½¿ç”¨
func UserGetHandler(svc services.IUserService) gin.HandlerFunc {
    return MakeHandler(
        endpoint.GetUserEndpoint(svc),
        func(c *gin.Context) (interface{}, error) {
            var req endpoint.GetUserRequest
            err := c.ShouldBindUri(&req)
            return req, err
        },
    )
}
```

### Q4: Serviceå±‚åº”è¯¥è¿”å› `interface{}` è¿˜æ˜¯å…·ä½“ç±»å‹ï¼Ÿ

**A**: å»ºè®®è¿”å›å…·ä½“ç±»å‹ï¼Œæ›´å®‰å…¨ï¼š

```go
// æ¨è
func (s *UserService) GetById(id string) (*User, error) {
    return &User{}, nil
}

// ä¸æ¨è
func (s *UserService) GetById(id string) (interface{}, error) {
    return &User{}, nil
}
```

### Q5: å¦‚ä½•å¤„ç†æ•°æ®åº“è¿æ¥ï¼Ÿ

**A**: åœ¨Serviceåˆå§‹åŒ–æ—¶æ³¨å…¥ï¼š

```go
type UserService struct {
    db *gorm.DB
}

func NewUserService(db *gorm.DB) IUserService {
    return &UserService{db: db}
}

// main.go
db := initDatabase()
userSvc := services.NewUserService(db)
```

---

## æ€»ç»“

| å±‚çº§ | èŒè´£ | æ˜¯å¦å¿…é¡»æ¯ä¸ªæ¥å£ä¸€ä¸ª |
|------|------|---------------------|
| Service | ä¸šåŠ¡é€»è¾‘ | âœ… æ¯ä¸ªä¸šåŠ¡æ–¹æ³•ä¸€ä¸ª |
| Endpoint | ç±»å‹è½¬æ¢ | âœ… æ¯ä¸ªæ¥å£ä¸€ä¸ªEndpointå‡½æ•° |
| Transport | HTTPå¤„ç† | âœ… æ¯ä¸ªæ¥å£ä¸€ä¸ªHandler |

**å…³é”®ç‚¹**:
- âœ… æ¯ä¸ªAPIæ¥å£éœ€è¦ä¸€ä¸ªEndpointå‡½æ•°
- âœ… ä½†åŒä¸€ä¸ªæ¨¡å—çš„æ‰€æœ‰Endpointå¯ä»¥æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­
- âœ… è¿™ç§è®¾è®¡åˆ©å¤§äºå¼Šï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸­å¤§å‹é¡¹ç›®ä¸­

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Go-Kit å®˜æ–¹æ–‡æ¡£](https://gokit.io/)
- [Gin æ¡†æ¶æ–‡æ¡£](https://gin-gonic.com/)
- [Go å¾®æœåŠ¡æœ€ä½³å®è·µ](https://github.com/golang-standards/project-layout)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-09-30  
**ç»´æŠ¤è€…**: Mule-Cloud Team
