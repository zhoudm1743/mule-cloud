# è®¢å•è¿½åŠ æ•°é‡è§£å†³æ–¹æ¡ˆ

## ğŸ“‹ ä¸šåŠ¡åœºæ™¯

è®¢å•å·²è¿›å…¥ç”Ÿäº§ï¼ˆå·²åˆ›å»ºè£å‰ªä»»åŠ¡æˆ–å·²å¼€å§‹è£å‰ªï¼‰ï¼Œå®¢æˆ·è¦æ±‚è¿½åŠ æ•°é‡ã€‚

### ç°å®æ¡ˆä¾‹
```
åŸè®¢å•ï¼šåˆåŒå·202510067553ï¼Œ1000ä»¶
å·²è£å‰ªï¼š500ä»¶ï¼ˆ5ä¸ªæ‰¹æ¬¡ï¼Œæ¯æ‰¹æ¬¡100ä»¶ï¼‰
å®¢æˆ·è¿½åŠ ï¼š+200ä»¶
æœŸæœ›ç»“æœï¼šè®¢å•å˜æˆ1200ä»¶ï¼Œæ–°å¢2ä¸ªè£å‰ªæ‰¹æ¬¡
```

---

## ğŸ¯ æ¨èæ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ1ï¼šè®¢å•è¿½åŠ åŠŸèƒ½ï¼ˆæ¨èç”¨äºåæœŸå¼€å‘ï¼‰â­â­â­â­â­

#### åŠŸèƒ½è®¾è®¡

**1. è®¢å•æ¨¡å‹æ‰©å±•**
```go
type Order struct {
    // åŸæœ‰å­—æ®µ...
    Quantity          int     `json:"quantity"`           // å½“å‰æ€»æ•°é‡
    OriginalQuantity  int     `json:"original_quantity"`  // åŸå§‹ä¸‹å•æ•°é‡
    AddedQuantity     int     `json:"added_quantity"`     // ç´¯è®¡è¿½åŠ æ•°é‡
    AddHistory        []AddRecord `json:"add_history"`    // è¿½åŠ å†å²
}

type AddRecord struct {
    Quantity   int    `json:"quantity"`    // æœ¬æ¬¡è¿½åŠ æ•°é‡
    Reason     string `json:"reason"`      // è¿½åŠ åŸå› 
    AddedBy    string `json:"added_by"`    // è¿½åŠ äºº
    AddedAt    int64  `json:"added_at"`    // è¿½åŠ æ—¶é—´
}
```

**2. å‰ç«¯ç•Œé¢**

è®¢å•åˆ—è¡¨å¢åŠ "è¿½åŠ "æŒ‰é’®ï¼š
```
æ“ä½œæ ï¼š
[è¯¦æƒ…] [ç¼–è¾‘] [è£å‰ª] [å¤åˆ¶] [è¿½åŠ ] [åˆ é™¤]
                              â†‘ æ–°å¢
```

è¿½åŠ å¼¹çª—ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è®¢å•è¿½åŠ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸå§‹æ•°é‡ï¼š1000ä»¶            â”‚
â”‚ å·²è¿½åŠ ï¼š  0ä»¶               â”‚
â”‚ å½“å‰æ€»é‡ï¼š1000ä»¶            â”‚
â”‚                            â”‚
â”‚ æœ¬æ¬¡è¿½åŠ æ•°é‡ï¼š[___] ä»¶      â”‚
â”‚ è¿½åŠ åŸå› ï¼š                  â”‚
â”‚ [_____________________]    â”‚
â”‚                            â”‚
â”‚     [å–æ¶ˆ]    [ç¡®è®¤è¿½åŠ ]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**3. åç«¯API**

```go
// POST /order/orders/:id/add-quantity
type OrderAddQuantityRequest struct {
    ID          string `uri:"id" binding"required"`
    AddQuantity int    `json:"add_quantity" binding"required,gt=0"`
    Reason      string `json:"reason"`
    AddedBy     string `json:"added_by"`
}

func (s *OrderService) AddQuantity(ctx context.Context, req *dto.OrderAddQuantityRequest) error {
    // 1. è·å–è®¢å•
    order, err := s.repo.Get(ctx, req.ID)
    if err != nil {
        return err
    }
    
    // 2. æ£€æŸ¥è®¢å•çŠ¶æ€ï¼ˆè‰ç¨¿çŠ¶æ€ä¸å…è®¸è¿½åŠ ï¼Œåº”è¯¥ç›´æ¥ä¿®æ”¹ï¼‰
    if order.Status == 0 {
        return fmt.Errorf("è‰ç¨¿çŠ¶æ€è®¢å•è¯·ç›´æ¥ä¿®æ”¹æ•°é‡")
    }
    
    // 3. æ›´æ–°è®¢å•æ•°é‡
    if order.OriginalQuantity == 0 {
        order.OriginalQuantity = order.Quantity  // ç¬¬ä¸€æ¬¡è¿½åŠ æ—¶è®°å½•åŸå§‹æ•°é‡
    }
    order.AddedQuantity += req.AddQuantity
    order.Quantity += req.AddQuantity
    order.TotalAmount = float64(order.Quantity) * order.UnitPrice
    
    // 4. è®°å½•è¿½åŠ å†å²
    addRecord := models.AddRecord{
        Quantity: req.AddQuantity,
        Reason:   req.Reason,
        AddedBy:  req.AddedBy,
        AddedAt:  time.Now().Unix(),
    }
    order.AddHistory = append(order.AddHistory, addRecord)
    
    // 5. æ›´æ–°è®¢å•
    err = s.repo.Update(ctx, req.ID, bson.M{
        "quantity":          order.Quantity,
        "original_quantity": order.OriginalQuantity,
        "added_quantity":    order.AddedQuantity,
        "total_amount":      order.TotalAmount,
        "add_history":       order.AddHistory,
        "updated_at":        time.Now().Unix(),
    })
    if err != nil {
        return err
    }
    
    // 6. æ›´æ–°è£å‰ªä»»åŠ¡æ€»ä»¶æ•°
    task, err := s.cuttingTaskRepo.GetByOrderID(ctx, req.ID)
    if err == nil && task != nil {
        task.TotalPieces += req.AddQuantity
        _ = s.cuttingTaskRepo.Update(ctx, task.ID, task)
    }
    
    return nil
}
```

**4. è¿½åŠ åçš„è£å‰ªæµç¨‹**

ç”¨æˆ·è¿½åŠ æ•°é‡åï¼š
1. è®¢å•æ€»æ•°é‡è‡ªåŠ¨æ›´æ–°ï¼š1000 â†’ 1200
2. è£å‰ªä»»åŠ¡æ€»ä»¶æ•°æ›´æ–°ï¼š1000 â†’ 1200
3. ç”¨æˆ·ç»§ç»­åˆ›å»ºè£å‰ªæ‰¹æ¬¡ï¼ˆåˆ¶è²ï¼‰è¡¥è¶³è¿½åŠ çš„æ•°é‡
4. è¿›åº¦è®¡ç®—åŸºäºæ–°çš„æ€»æ•°é‡

#### ä¼˜ç‚¹
- âœ… ä¿ç•™å®Œæ•´çš„è¿½åŠ å†å²
- âœ… æ•°æ®ç»“æ„æ¸…æ™°
- âœ… ä¾¿äºç»Ÿè®¡å’Œå®¡è®¡
- âœ… æ”¯æŒå¤šæ¬¡è¿½åŠ 

#### ç¼ºç‚¹
- âŒ éœ€è¦å¼€å‘æ–°åŠŸèƒ½ï¼ˆçº¦1-2å¤©ï¼‰

---

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨"å¤åˆ¶è®¢å•"åŠŸèƒ½ï¼ˆç«‹å³å¯ç”¨ï¼‰â­â­â­â­

#### æ“ä½œæµç¨‹

**æ­¥éª¤1ï¼šå¤åˆ¶åŸè®¢å•**
```
è®¢å•åˆ—è¡¨ä¸­æ‰¾åˆ°åŸè®¢å• â†’ ç‚¹å‡»"å¤åˆ¶"æŒ‰é’®
```

**æ­¥éª¤2ï¼šä¿®æ”¹å¤åˆ¶åçš„è®¢å•**
```
åˆåŒå·ï¼š202510067553-è¿½åŠ   ï¼ˆæ·»åŠ -è¿½åŠ åç¼€ï¼‰
æ•°é‡ï¼š200ä»¶                ï¼ˆåªå¡«è¿½åŠ çš„æ•°é‡ï¼‰
å¤‡æ³¨ï¼šåŸè®¢å•202510067553è¿½åŠ 200ä»¶
```

**æ­¥éª¤3ï¼šåˆ›å»ºè£å‰ªä»»åŠ¡**
```
æ­£å¸¸æµç¨‹ï¼šç‚¹å‡»"è£å‰ª" â†’ åˆ›å»ºè£å‰ªæ‰¹æ¬¡
```

**æ­¥éª¤4ï¼šç»Ÿè®¡æ—¶åˆå¹¶**
```
åœ¨ç»Ÿè®¡æŠ¥è¡¨ä¸­ï¼Œé€šè¿‡åˆåŒå·å‰ç¼€åŒ¹é…åˆå¹¶æ•°æ®
SELECT * FROM orders WHERE contract_no LIKE '202510067553%'
```

#### å®é™…ä½¿ç”¨ç¤ºä¾‹

**åŸè®¢å•**
- åˆåŒå·ï¼š202510067553
- æ•°é‡ï¼š1000ä»¶
- çŠ¶æ€ï¼šç”Ÿäº§ä¸­
- å·²è£å‰ªï¼š500ä»¶

**è¿½åŠ è®¢å•ï¼ˆå¤åˆ¶è€Œæ¥ï¼‰**
- åˆåŒå·ï¼š202510067553-è¿½åŠ 1
- æ•°é‡ï¼š200ä»¶
- çŠ¶æ€ï¼šå·²ä¸‹å•
- å¤‡æ³¨ï¼šåŸè®¢å•202510067553è¿½åŠ 200ä»¶

#### ä¼˜ç‚¹
- âœ… **ç«‹å³å¯ç”¨**ï¼Œæ— éœ€å¼€å‘
- âœ… æ“ä½œç®€å•ï¼Œä¸æ˜“å‡ºé”™
- âœ… æ•°æ®åˆ†ç¦»æ¸…æ™°
- âœ… åŸè®¢å•ä¸å—å½±å“

#### ç¼ºç‚¹
- âŒ ä¸¤ä¸ªè®¢å•ç‹¬ç«‹ï¼ŒæŸ¥è¯¢æ—¶éœ€è¦å…³è”
- âŒ éœ€è¦æ‰‹åŠ¨åœ¨å¤‡æ³¨ä¸­è¯´æ˜å…³è”å…³ç³»
- âŒ ç»Ÿè®¡æ—¶éœ€è¦åˆå¹¶è®¡ç®—

#### æ”¹è¿›å»ºè®®

å¯ä»¥åœ¨åˆåŒå·å‘½åä¸Šåšçº¦å®šï¼š
```
åŸè®¢å•ï¼š202510067553
è¿½åŠ 1ï¼š  202510067553-A1
è¿½åŠ 2ï¼š  202510067553-A2
```

---

### æ–¹æ¡ˆ3ï¼šç›´æ¥ä¿®æ”¹+é™åˆ¶ï¼ˆéœ€è¦ä»£ç æ”¹é€ ï¼‰â­â­â­

#### åŠŸèƒ½è®¾è®¡

**1. ä¿®æ”¹è®¢å•ç¼–è¾‘é€»è¾‘**

```go
func (s *OrderService) Update(ctx context.Context, req dto.OrderUpdateRequest) (*models.Order, error) {
    // è·å–åŸè®¢å•
    oldOrder, err := s.repo.Get(ctx, req.ID)
    if err != nil {
        return nil, err
    }
    
    // å¦‚æœè®¢å•å·²è¿›å…¥ç”Ÿäº§ï¼Œæ•°é‡åªèƒ½å¢åŠ ä¸èƒ½å‡å°‘
    if oldOrder.Status >= 1 { // å·²ä¸‹å•ã€ç”Ÿäº§ä¸­ã€å·²å®Œæˆ
        if req.Quantity < oldOrder.Quantity {
            return nil, fmt.Errorf("ç”Ÿäº§ä¸­çš„è®¢å•æ•°é‡ä¸èƒ½å‡å°‘ï¼Œå½“å‰æ•°é‡ï¼š%d", oldOrder.Quantity)
        }
        
        // å¦‚æœå¢åŠ æ•°é‡ï¼Œæ›´æ–°è£å‰ªä»»åŠ¡
        if req.Quantity > oldOrder.Quantity {
            addedQty := req.Quantity - oldOrder.Quantity
            
            // æ›´æ–°è£å‰ªä»»åŠ¡æ€»ä»¶æ•°
            task, _ := s.cuttingTaskRepo.GetByOrderID(ctx, req.ID)
            if task != nil {
                task.TotalPieces += addedQty
                _ = s.cuttingTaskRepo.Update(ctx, task.ID, task)
            }
        }
    }
    
    // æ­£å¸¸çš„æ›´æ–°æµç¨‹...
}
```

**2. å‰ç«¯æç¤º**

ä¿®æ”¹è®¢å•æ•°é‡æ—¶ï¼š
```javascript
if (modalType.value === 'edit' && order.status >= 1) {
  // æ˜¾ç¤ºæç¤º
  window.$message.info('è®¢å•å·²è¿›å…¥ç”Ÿäº§ï¼Œæ•°é‡åªèƒ½å¢åŠ ä¸èƒ½å‡å°‘');
  
  // è®¾ç½®æœ€å°å€¼
  quantityMin.value = order.quantity;
}
```

#### ä½¿ç”¨æµç¨‹

1. ç‚¹å‡»è®¢å•"ç¼–è¾‘"
2. ä¿®æ”¹æ•°é‡ï¼š1000 â†’ 1200
3. ç³»ç»Ÿè‡ªåŠ¨ï¼š
   - æ›´æ–°è®¢å•æ€»æ•°é‡
   - æ›´æ–°è£å‰ªä»»åŠ¡æ€»ä»¶æ•°
   - æ›´æ–°æ€»é‡‘é¢
4. ç”¨æˆ·ç»§ç»­åˆ›å»ºè£å‰ªæ‰¹æ¬¡è¡¥è¶³200ä»¶

#### ä¼˜ç‚¹
- âœ… æ“ä½œç›´è§‚ç®€å•
- âœ… æ•°æ®ç»Ÿä¸€ï¼Œæ— éœ€åˆå¹¶

#### ç¼ºç‚¹
- âŒ æ²¡æœ‰è¿½åŠ å†å²è®°å½•
- âŒ ä¸çŸ¥é“å“ªäº›æ˜¯åŸå§‹è®¢å•ï¼Œå“ªäº›æ˜¯è¿½åŠ çš„
- âŒ å¦‚æœæœ‰é¢œè‰²å°ºç æ˜ç»†ï¼Œä¿®æ”¹ä¼šå¾ˆå¤æ‚

---

## ğŸ¨ é¢œè‰²å°ºç ç»„åˆçš„ç‰¹æ®Šå¤„ç†

### é—®é¢˜
å¦‚æœè®¢å•æœ‰é¢œè‰²å°ºç æ˜ç»†ï¼š
```
è“è‰²-Lï¼š100ä»¶
è“è‰²-XLï¼š150ä»¶
çº¢è‰²-Lï¼š120ä»¶
...
æ€»è®¡ï¼š1000ä»¶
```

è¿½åŠ 200ä»¶åº”è¯¥æ€ä¹ˆåˆ†é…åˆ°å„ä¸ªç»„åˆï¼Ÿ

### è§£å†³æ–¹æ¡ˆ

#### é€‰é¡¹Aï¼šæŒ‰æ¯”ä¾‹åˆ†é…ï¼ˆè‡ªåŠ¨ï¼‰
```javascript
// è®¡ç®—æ¯ä¸ªç»„åˆçš„æ¯”ä¾‹
const total = order.items.reduce((sum, item) => sum + item.quantity, 0);
const addQuantity = 200;

order.items.forEach(item => {
  const ratio = item.quantity / total;
  const addQty = Math.round(addQuantity * ratio);
  item.quantity += addQty;
});
```

#### é€‰é¡¹Bï¼šæ‰‹åŠ¨æŒ‡å®šï¼ˆçµæ´»ï¼‰
```
è¿½åŠ å¼¹çª—ä¸­æ˜¾ç¤ºé¢œè‰²å°ºç è¡¨æ ¼ï¼Œè®©ç”¨æˆ·å¡«å†™æ¯ä¸ªç»„åˆè¿½åŠ å¤šå°‘ä»¶ï¼š

é¢œè‰²  å°ºç   åŸæ•°é‡  è¿½åŠ æ•°é‡
è“è‰²  L    100     [20]
è“è‰²  XL   150     [30]
çº¢è‰²  L    120     [25]
...

æ€»è®¡è¿½åŠ ï¼š200ä»¶
```

---

## ğŸ“Š æ¨èé€‰æ‹©

### å½“å‰é˜¶æ®µï¼ˆç«‹å³å¯ç”¨ï¼‰â†’ æ–¹æ¡ˆ2
**ä½¿ç”¨"å¤åˆ¶è®¢å•"åŠŸèƒ½**
- ä¼˜ç‚¹ï¼šæ— éœ€å¼€å‘ï¼Œç«‹å³å¯ç”¨
- é€‚ç”¨ï¼šä¸´æ—¶æ–¹æ¡ˆï¼Œè¿½åŠ é¢‘ç‡ä¸é«˜
- æ“ä½œï¼šå¤åˆ¶ â†’ ä¿®æ”¹æ•°é‡ â†’ åˆ›å»ºè£å‰ªä»»åŠ¡

### åæœŸä¼˜åŒ–ï¼ˆå°ç¨‹åºä¸Šçº¿åï¼‰â†’ æ–¹æ¡ˆ1
**å¼€å‘"è®¢å•è¿½åŠ "åŠŸèƒ½**
- ä¼˜ç‚¹ï¼šåŠŸèƒ½å®Œæ•´ï¼Œä½“éªŒå¥½
- æ—¶æœºï¼šä¸å°ç¨‹åºä¸€èµ·å¼€å‘
- å†…å®¹ï¼šè¿½åŠ æŒ‰é’® + è¿½åŠ å†å² + è‡ªåŠ¨åŒæ­¥

---

## ğŸ”§ æ–¹æ¡ˆ2çš„å…·ä½“æ“ä½œæŒ‡å—

### æ“ä½œæ­¥éª¤

**1. æ‰¾åˆ°åŸè®¢å•**
```
è®¢å•ç®¡ç† â†’ æœç´¢åˆåŒå·ï¼š202510067553
```

**2. ç‚¹å‡»"å¤åˆ¶"**
```
æ“ä½œæ ï¼š[è¯¦æƒ…] [ç¼–è¾‘] [è£å‰ª] [å¤åˆ¶] â† ç‚¹è¿™é‡Œ
```

**3. ä¿®æ”¹å¤åˆ¶çš„è®¢å•**
```
åˆåŒå·ï¼š202510067553-A1      ï¼ˆæ·»åŠ åç¼€åŒºåˆ†ï¼‰
å®¢æˆ·ï¼š  XXæœè£…å‚            ï¼ˆä¿æŒä¸å˜ï¼‰
æ•°é‡ï¼š  200ä»¶               ï¼ˆåªå¡«è¿½åŠ æ•°é‡ï¼‰
å•ä»·ï¼š  2.00               ï¼ˆä¿æŒä¸å˜ï¼‰
å¤‡æ³¨ï¼š  åŸå•202510067553è¿½åŠ 200ä»¶ï¼Œ2024-10-07
```

**4. ä¿å­˜å¹¶åˆ›å»ºè£å‰ªä»»åŠ¡**
```
ä¿å­˜è®¢å• â†’ ç‚¹å‡»"è£å‰ª" â†’ åˆ›å»ºè£å‰ªæ‰¹æ¬¡
```

**5. ç»Ÿè®¡æ—¶åˆå¹¶**
```
è®¢å•åˆ—è¡¨æœç´¢ï¼š202510067553
ä¼šåŒæ—¶æ˜¾ç¤ºï¼š
- 202510067553 (1000ä»¶)
- 202510067553-A1 (200ä»¶)

æ‰‹åŠ¨åˆå¹¶ç»Ÿè®¡å³å¯
```

### å‘½åè§„èŒƒå»ºè®®

```
åŸè®¢å•ï¼š{åˆåŒå·}
è¿½åŠ 1ï¼š {åˆåŒå·}-A1
è¿½åŠ 2ï¼š {åˆåŒå·}-A2
è¿½åŠ 3ï¼š {åˆåŒå·}-A3
```

ä¾‹å¦‚ï¼š
- 202510067553
- 202510067553-A1
- 202510067553-A2

---

## ğŸ’» æ–¹æ¡ˆ1çš„å®ç°ä»£ç ï¼ˆä¾›åæœŸå‚è€ƒï¼‰

### 1. æ•°æ®æ¨¡å‹æ‰©å±•

```go
// internal/models/order.go
type Order struct {
    // ...ç°æœ‰å­—æ®µ
    OriginalQuantity int         `json:"original_quantity" bson:"original_quantity"` // åŸå§‹æ•°é‡
    AddedQuantity    int         `json:"added_quantity" bson:"added_quantity"`       // è¿½åŠ æ•°é‡
    AddHistory       []AddRecord `json:"add_history" bson:"add_history"`             // è¿½åŠ å†å²
}

type AddRecord struct {
    Quantity int    `json:"quantity" bson:"quantity"`       // è¿½åŠ æ•°é‡
    Reason   string `json:"reason" bson:"reason"`           // è¿½åŠ åŸå› 
    AddedBy  string `json:"added_by" bson:"added_by"`       // è¿½åŠ äºº
    AddedAt  int64  `json:"added_at" bson:"added_at"`       // è¿½åŠ æ—¶é—´
}
```

### 2. DTOå®šä¹‰

```go
// app/order/dto/order.go
type OrderAddQuantityRequest struct {
    ID          string `uri:"id" binding"required"`
    AddQuantity int    `json:"add_quantity" binding"required,gt=0"`
    Reason      string `json:"reason"`
    AddedBy     string `json:"added_by"`
}

type OrderAddQuantityResponse struct {
    Order *models.Order `json:"order"`
}
```

### 3. Serviceå±‚

```go
// app/order/services/order.go
func (s *OrderService) AddQuantity(ctx context.Context, req dto.OrderAddQuantityRequest) (*models.Order, error) {
    // è·å–è®¢å•
    order, err := s.repo.Get(ctx, req.ID)
    if err != nil {
        return nil, err
    }
    
    // è‰ç¨¿çŠ¶æ€ä¸å…è®¸è¿½åŠ 
    if order.Status == 0 {
        return nil, fmt.Errorf("è‰ç¨¿çŠ¶æ€è®¢å•è¯·ç›´æ¥ä¿®æ”¹æ•°é‡")
    }
    
    // ç¬¬ä¸€æ¬¡è¿½åŠ æ—¶è®°å½•åŸå§‹æ•°é‡
    if order.OriginalQuantity == 0 {
        order.OriginalQuantity = order.Quantity
    }
    
    // æ›´æ–°æ•°é‡
    order.AddedQuantity += req.AddQuantity
    order.Quantity += req.AddQuantity
    order.TotalAmount = float64(order.Quantity) * order.UnitPrice
    
    // è®°å½•è¿½åŠ å†å²
    addRecord := models.AddRecord{
        Quantity: req.AddQuantity,
        Reason:   req.Reason,
        AddedBy:  req.AddedBy,
        AddedAt:  time.Now().Unix(),
    }
    order.AddHistory = append(order.AddHistory, addRecord)
    
    // æ›´æ–°æ•°æ®åº“
    update := bson.M{
        "quantity":          order.Quantity,
        "original_quantity": order.OriginalQuantity,
        "added_quantity":    order.AddedQuantity,
        "total_amount":      order.TotalAmount,
        "add_history":       order.AddHistory,
        "updated_at":        time.Now().Unix(),
    }
    
    err = s.repo.Update(ctx, req.ID, update)
    if err != nil {
        return nil, err
    }
    
    // æ›´æ–°è£å‰ªä»»åŠ¡
    task, _ := s.cuttingTaskRepo.GetByOrderID(ctx, req.ID)
    if task != nil {
        task.TotalPieces += req.AddQuantity
        _ = s.cuttingTaskRepo.Update(ctx, task.ID, task)
    }
    
    return s.repo.Get(ctx, req.ID)
}
```

### 4. å‰ç«¯å®ç°

```vue
<!-- è®¢å•åˆ—è¡¨ -->
<template>
  <NButton 
    size="small" 
    type="warning"
    @click="handleAddQuantity(row)"
  >
    è¿½åŠ 
  </NButton>
</template>

<script setup>
// è¿½åŠ æ•°é‡å¼¹çª—
const addQuantityModal = ref(false);
const addQuantityForm = ref({
  add_quantity: 0,
  reason: ''
});

async function handleAddQuantity(order) {
  currentOrder.value = order;
  addQuantityForm.value = {
    add_quantity: 0,
    reason: ''
  };
  addQuantityModal.value = true;
}

async function confirmAddQuantity() {
  try {
    await addOrderQuantity(currentOrder.value.id, addQuantityForm.value);
    window.$message.success('è¿½åŠ æˆåŠŸ');
    addQuantityModal.value = false;
    fetchData();
  } catch (error) {
    window.$message.error(error.message || 'è¿½åŠ å¤±è´¥');
  }
}
</script>
```

---

## ğŸ“Œ æ€»ç»“

### ç«‹å³ä½¿ç”¨ï¼ˆæ¨èï¼‰
ğŸ‘‰ **æ–¹æ¡ˆ2ï¼šå¤åˆ¶è®¢å•**
- æ— éœ€å¼€å‘
- æ“ä½œç®€å•
- åˆåŒå·åŠ åç¼€åŒºåˆ†

### åæœŸå¼€å‘ï¼ˆç†æƒ³ï¼‰
ğŸ‘‰ **æ–¹æ¡ˆ1ï¼šè®¢å•è¿½åŠ åŠŸèƒ½**
- ä¿ç•™å†å²
- æ•°æ®å®Œæ•´
- ä½“éªŒæ›´å¥½

æ ¹æ®æ‚¨å½“å‰çš„æƒ…å†µï¼Œå»ºè®®å…ˆç”¨æ–¹æ¡ˆ2ï¼ˆå¤åˆ¶è®¢å•ï¼‰è§£å†³ç‡ƒçœ‰ä¹‹æ€¥ï¼Œç­‰å°ç¨‹åºå¼€å‘æ—¶å†å®ç°æ–¹æ¡ˆ1çš„å®Œæ•´åŠŸèƒ½ã€‚
