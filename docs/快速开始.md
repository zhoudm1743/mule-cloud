# å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ¯ 5åˆ†é’Ÿå¿«é€Ÿä½“éªŒ

### æ­¥éª¤ 1: å¯åŠ¨Consul

```bash
# æ‰“å¼€ç»ˆç«¯1
consul agent -dev
```

ä¿æŒç»ˆç«¯è¿è¡Œï¼Œè®¿é—® http://localhost:8500 ç¡®è®¤Consulå·²å¯åŠ¨ã€‚

### æ­¥éª¤ 2: å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# æ‰“å¼€æ–°ç»ˆç«¯ï¼Œè¿›å…¥é¡¹ç›®ç›®å½•
cd K:\Git\mule-cloud

# ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
.\scripts\start_all.bat
```

ä¼šè‡ªåŠ¨æ‰“å¼€5ä¸ªçª—å£ï¼Œåˆ†åˆ«å¯åŠ¨ï¼š
1. Test HTTPæœåŠ¡ (:8000)
2. Basic HTTPæœåŠ¡ (:8001)  
3. Admin gRPCæœåŠ¡ (:9000)
4. Product gRPCæœåŠ¡ (:9001)
5. APIç½‘å…³ (:8080)

### æ­¥éª¤ 3: æµ‹è¯•æœåŠ¡

**æ‰“å¼€æ–°ç»ˆç«¯**:

```bash
# æµ‹è¯•ç½‘å…³å¥åº·æ£€æŸ¥
curl http://localhost:8080/gateway/health

# æµ‹è¯•å…¬å¼€æ¥å£ï¼ˆæ— éœ€ç™»å½•ï¼‰
curl http://localhost:8080/basic/color/1

# å“åº”ç¤ºä¾‹
{
  "code": 0,
  "msg": "success",
  "data": {
    "color": {
      "id": "1",
      "name": "çº¢è‰²",
      "hex_code": "#FF0000"
    }
  }
}
```

### æ­¥éª¤ 4: ç™»å½•è·å–Token

```bash
# ç®¡ç†å‘˜ç™»å½•
curl -X POST http://localhost:8080/api/login ^
  -H "Content-Type: application/json" ^
  -d "{\"username\":\"admin\",\"password\":\"admin123\"}"

# å“åº”ç¤ºä¾‹
{
  "code": 0,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiMSIsInVzZXJuYW1lIjoiYWRtaW4iLCJyb2xlcyI6WyJhZG1pbiIsInVzZXIiXSwiZXhwIjoxNzM1Njg5NjAwLCJpYXQiOjE3MzU2MDMyMDAsImlzcyI6Im11bGUtY2xvdWQifQ.xxxxx",
    "username": "admin",
    "roles": ["admin", "user"]
  }
}
```

**å¤åˆ¶token**ï¼ˆä¸‹é¢ç”¨`{TOKEN}`è¡¨ç¤ºï¼‰

### æ­¥éª¤ 5: è®¿é—®å—ä¿æŠ¤æ¥å£

```bash
# è·å–ç®¡ç†å‘˜ä¿¡æ¯ï¼ˆéœ€è¦ç™»å½•ï¼‰
curl -H "Authorization: Bearer {TOKEN}" ^
  http://localhost:8080/test/admin/1

# å“åº”ç¤ºä¾‹
{
  "code": 0,
  "msg": "success",
  "data": {
    "admin": {
      "id": "1",
      "name": "è¶…çº§ç®¡ç†å‘˜",
      "email": "admin@example.com",
      "role": "admin",
      "created_at": "2024-12-01T10:00:00Z"
    },
    "requested_by": "admin"
  }
}
```

### æ­¥éª¤ 6: æµ‹è¯•gRPCæœåŠ¡ï¼ˆå¯é€‰ï¼‰

```bash
# å®‰è£…grpcurl
go install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest

# æµ‹è¯•Admin gRPCæœåŠ¡
grpcurl -plaintext -d "{\"id\":\"1\"}" ^
  localhost:9000 admin.AdminService/GetAdmin

# å“åº”ç¤ºä¾‹
{
  "admin": {
    "id": "1",
    "name": "è¶…çº§ç®¡ç†å‘˜",
    "email": "admin@example.com",
    "role": "admin",
    "createdAt": "1701424800"
  }
}
```

## ğŸ¨ å®Œæ•´æµ‹è¯•æµç¨‹

è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼š

```bash
.\scripts\test_services.bat
```

ä¼šè‡ªåŠ¨æµ‹è¯•ï¼š
- âœ… ç½‘å…³å¥åº·æ£€æŸ¥
- âœ… å…¬å¼€æ¥å£ï¼ˆé¢œè‰²ã€å°ºå¯¸ï¼‰
- âœ… ç™»å½•æ¥å£
- âœ… æ˜¾ç¤ºTokenä¾›æ‰‹åŠ¨æµ‹è¯•

## ğŸ“Š æœåŠ¡ç«¯å£ä¸€è§ˆ

| æœåŠ¡ | ç«¯å£ | URL | è¯´æ˜ |
|------|------|-----|------|
| Consul | 8500 | http://localhost:8500 | æœåŠ¡æ³¨å†Œä¸­å¿ƒ |
| TestæœåŠ¡ | 8000 | http://localhost:8000 | Adminç®¡ç†æœåŠ¡ |
| BasicæœåŠ¡ | 8001 | http://localhost:8001 | åŸºç¡€æœåŠ¡ |
| Admin gRPC | 9000 | grpc://localhost:9000 | ç®¡ç†gRPCæœåŠ¡ |
| Product gRPC | 9001 | grpc://localhost:9001 | äº§å“gRPCæœåŠ¡ |
| **APIç½‘å…³** | **8080** | **http://localhost:8080** | **ç»Ÿä¸€å…¥å£** |

## ğŸ” æµ‹è¯•è´¦å·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² | æƒé™ |
|--------|------|------|------|
| admin | admin123 | admin, user | æ‰€æœ‰æ¥å£ |
| user | user123 | user | ä»…åŸºç¡€æ¥å£ |

## ğŸ“ å¸¸ç”¨APIç«¯ç‚¹

### å…¬å¼€æ¥å£ï¼ˆæ— éœ€è®¤è¯ï¼‰

```bash
# è·å–æ‰€æœ‰é¢œè‰²
GET http://localhost:8080/basic/color

# è·å–æŒ‡å®šé¢œè‰²
GET http://localhost:8080/basic/color/1

# è·å–æ‰€æœ‰å°ºå¯¸
GET http://localhost:8080/basic/size

# è·å–æŒ‡å®šå°ºå¯¸
GET http://localhost:8080/basic/size/2

# ç½‘å…³å¥åº·æ£€æŸ¥
GET http://localhost:8080/gateway/health

# ç™»å½•
POST http://localhost:8080/api/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}
```

### éœ€è¦è®¤è¯çš„æ¥å£

```bash
# è·å–ç®¡ç†å‘˜ä¿¡æ¯
GET http://localhost:8080/test/admin/{id}
Authorization: Bearer {token}

# åˆ é™¤ç®¡ç†å‘˜
DELETE http://localhost:8080/test/admin/{id}
Authorization: Bearer {token}

# åˆ›å»ºç®¡ç†å‘˜
POST http://localhost:8080/test/admin
Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "æ–°ç®¡ç†å‘˜",
  "email": "new@example.com",
  "role": "manager"
}

# æ›´æ–°ç®¡ç†å‘˜
PUT http://localhost:8080/test/admin/{id}
Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "æ›´æ–°çš„åå­—",
  "email": "updated@example.com",
  "role": "manager"
}
```

## ğŸ¯ é€šè¿‡ç½‘å…³ vs ç›´è¿æœåŠ¡

### âŒ ä¸æ¨èï¼šç›´è¿æœåŠ¡

```bash
# ç›´è¿TestæœåŠ¡ï¼ˆç»•è¿‡ç½‘å…³ï¼‰
curl http://localhost:8000/admin/1

# é—®é¢˜ï¼š
# - æ²¡æœ‰ç»Ÿä¸€è®¤è¯
# - æ²¡æœ‰é™æµä¿æŠ¤
# - å®¢æˆ·ç«¯éœ€è¦çŸ¥é“æ‰€æœ‰æœåŠ¡åœ°å€
```

### âœ… æ¨èï¼šé€šè¿‡ç½‘å…³

```bash
# é€šè¿‡ç½‘å…³è®¿é—®ï¼ˆæ¨èï¼‰
curl -H "Authorization: Bearer {token}" ^
  http://localhost:8080/test/admin/1

# ä¼˜åŠ¿ï¼š
# - ç»Ÿä¸€è®¤è¯é‰´æƒ
# - ç»Ÿä¸€æ—¥å¿—ç›‘æ§
# - é™æµä¿æŠ¤
# - å®¢æˆ·ç«¯åªéœ€çŸ¥é“ç½‘å…³åœ°å€
```

## ğŸ”„ æœåŠ¡é‡å¯

### é‡å¯å•ä¸ªæœåŠ¡

```bash
# åœ¨å¯¹åº”çš„æœåŠ¡çª—å£æŒ‰ Ctrl+C
# ç„¶åé‡æ–°è¿è¡Œ

cd test/cmd
go run main.go
```

### é‡å¯æ‰€æœ‰æœåŠ¡

```bash
# å…³é—­æ‰€æœ‰æœåŠ¡çª—å£
# é‡æ–°è¿è¡Œå¯åŠ¨è„šæœ¬
.\scripts\start_all.bat
```

## ğŸ› é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æœåŠ¡æ— æ³•å¯åŠ¨

**æ£€æŸ¥ç«¯å£å ç”¨**:
```bash
netstat -ano | findstr "8080"
netstat -ano | findstr "8000"
```

**è§£å†³**: å…³é—­å ç”¨ç«¯å£çš„ç¨‹åºæˆ–ä¿®æ”¹æœåŠ¡ç«¯å£

### é—®é¢˜2: Consulè¿æ¥å¤±è´¥

**æ£€æŸ¥Consulæ˜¯å¦è¿è¡Œ**:
```bash
curl http://localhost:8500/v1/status/leader
```

**è§£å†³**: 
```bash
consul agent -dev
```

### é—®é¢˜3: TokenéªŒè¯å¤±è´¥

**å¸¸è§åŸå› **:
- Tokenæ ¼å¼é”™è¯¯ï¼ˆåº”è¯¥æ˜¯ `Bearer {token}`ï¼‰
- Tokenè¿‡æœŸï¼ˆ24å°æ—¶ï¼‰
- JWTå¯†é’¥ä¸åŒ¹é…

**è§£å†³**: é‡æ–°ç™»å½•è·å–æ–°Token

### é—®é¢˜4: Protoæ–‡ä»¶ä¿®æ”¹åä¸ç”Ÿæ•ˆ

**é‡æ–°ç”ŸæˆProtoä»£ç **:
```bash
.\scripts\generate_proto.bat
```

## ğŸ“š ä¸‹ä¸€æ­¥

- ğŸ“– [å®Œæ•´æ¶æ„è¯´æ˜](æ¶æ„è¯´æ˜.md)
- ğŸšª [APIç½‘å…³è¯¦è§£](APIç½‘å…³æŒ‡å—.md)
- ğŸ” [JWTè®¤è¯æŒ‡å—](JWTå’ŒgRPCé›†æˆæŒ‡å—.md)
- ğŸ—ï¸ [æ·»åŠ æ–°æœåŠ¡](å¿«é€Ÿå¼€å‘æŒ‡å—.md)

## ğŸ’¡ å¼€å‘æŠ€å·§

### ä½¿ç”¨Postmanæµ‹è¯•

1. å¯¼å…¥Collection
2. è®¾ç½®ç¯å¢ƒå˜é‡:
   - `base_url`: http://localhost:8080
   - `token`: ä»ç™»å½•æ¥å£è·å–
3. åœ¨éœ€è¦è®¤è¯çš„è¯·æ±‚ä¸­æ·»åŠ :
   - Header: `Authorization` = `Bearer {{token}}`

### ä½¿ç”¨VSCode REST Client

åˆ›å»º `test.http`:

```http
### ç™»å½•
POST http://localhost:8080/api/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}

### ä¿å­˜tokenåä½¿ç”¨
@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

### è·å–ç®¡ç†å‘˜
GET http://localhost:8080/test/admin/1
Authorization: Bearer {{token}}
```

---

ğŸ‰ **æ­å–œï¼æ‚¨å·²ç»å®Œæˆäº†å¿«é€Ÿå…¥é—¨ã€‚**

ç°åœ¨æ‚¨å¯ä»¥ï¼š
- âœ… è®¿é—®å…¬å¼€æ¥å£
- âœ… ç™»å½•è·å–Token
- âœ… è®¿é—®å—ä¿æŠ¤æ¥å£
- âœ… è°ƒç”¨gRPCæœåŠ¡
- âœ… å¼€å§‹å¼€å‘æ–°åŠŸèƒ½ï¼
