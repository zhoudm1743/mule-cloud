# 订单服务前端实现完成

## 概述

已完成订单服务的前端实现，包括订单管理和款式管理两大模块的完整界面。

## 实现内容

### 1. 类型定义 (`typings/api/order.d.ts`)

定义了完整的TypeScript类型：

#### 订单相关类型
- `OrderInfo` - 订单信息
- `OrderItem` - 订单明细（颜色+尺码组合）
- `OrderProcedure` - 订单工序
- `CreateRequest` - 创建订单请求（步骤1）
- `UpdateStyleRequest` - 更新款式请求（步骤2）
- `UpdateProcedureRequest` - 更新工序请求（步骤3）
- `UpdateRequest` - 更新订单请求
- `ListRequest` - 列表查询请求
- `ListResponse` - 列表响应
- `OrderResponse` - 订单详情响应

#### 款式相关类型
- `StyleInfo` - 款式信息
- `StyleProcedure` - 款式工序
- `CreateStyleRequest` - 创建款式请求
- `UpdateStyleRequest` - 更新款式请求
- `StyleListRequest` - 款式列表请求
- `StyleListResponse` - 款式列表响应
- `StyleResponse` - 款式详情响应

### 2. API 服务 (`service/api/order.ts`)

实现了完整的HTTP API调用：

#### 订单API
- `fetchOrderList` - 分页查询订单
- `fetchOrderDetail` - 获取订单详情
- `createOrder` - 创建订单（步骤1）
- `updateOrderStyle` - 更新订单款式（步骤2）
- `updateOrderProcedure` - 更新订单工序（步骤3）
- `updateOrder` - 更新订单
- `copyOrder` - 复制订单
- `deleteOrder` - 删除订单

#### 款式API
- `fetchStyleList` - 分页查询款式
- `fetchAllStyles` - 获取所有款式（不分页）
- `fetchStyleDetail` - 获取款式详情
- `createStyle` - 创建款式
- `updateStyle` - 更新款式
- `deleteStyle` - 删除款式

### 3. 订单管理页面 (`views/order/orders/`)

#### 主页面 (`index.vue`)

**功能特性：**
- ✅ 订单列表展示（表格形式）
- ✅ 多条件搜索（合同号、款号、状态）
- ✅ 分页功能
- ✅ 批量删除
- ✅ 状态标签（不同颜色显示不同状态）
- ✅ 订单操作按钮（查看、编辑、复制、删除）

**列表字段：**
- 图片 - 款式图片预览
- 合同号 - 可复制
- 客户名称
- 款号
- 数量
- 单价
- 总金额
- 进度百分比
- 交货日期
- 订单类型
- 状态标签
- 下单时间
- 备注
- 操作按钮

#### 编辑弹窗 (`components/TableModal.vue`)

**三步骤创建流程：**

**步骤1：基础信息**
- 合同号（必填）
- 客户选择（下拉，必填）
- 交货日期（日期选择器）
- 订单类型（下拉选择）
- 业务员（下拉选择）
- 备注（多行文本）

**步骤2：款式数量**
- 款式选择（下拉搜索）
- 单价设置
- 总数量（自动计算）
- 颜色尺码数量配置表格
  - 自动生成所有颜色+尺码组合
  - 每个组合可单独设置数量
  - 数量输入框

**步骤3：工序清单**
- 工序列表表格
  - 顺序号
  - 工序名称
  - 工价（可编辑）
  - 指定工人（可编辑）
  - 最慢工序（复选框）
  - 不分扎（复选框）

**编辑模式：**
- 直接显示所有信息
- 支持修改所有字段
- 一次性保存

**查看模式：**
- 所有字段只读
- 不显示保存按钮

### 4. 款式管理页面 (`views/order/styles/`)

#### 主页面 (`index.vue`)

**功能特性：**
- ✅ 款式列表展示
- ✅ 多条件搜索（款号、款名、状态）
- ✅ 分页功能
- ✅ 批量删除
- ✅ 状态标签（启用/禁用）

**列表字段：**
- 图片 - 款式图片预览
- ID - 可复制
- 款号
- 款名
- 单价
- 颜色列表
- 尺码列表
- 工序数量
- 状态
- 创建时间
- 备注
- 操作按钮（查看、编辑、删除）

#### 编辑弹窗 (`components/TableModal.vue`)

**三标签页结构：**

**基础信息标签：**
- 款号（必填，编辑时不可修改）
- 款名（必填）
- 分类
- 季节
- 年份
- 单价
- 状态（单选：启用/禁用）
- 备注

**颜色尺码标签：**
- 颜色多选（从基础数据选择）
- 尺码多选（从基础数据选择）

**工序清单标签：**
- 添加工序按钮
- 工序列表表格
  - 顺序号
  - 工序选择（下拉）
  - 工价输入
  - 最慢工序标记
  - 不分扎标记
  - 操作按钮（上移、下移、删除）

## 技术实现

### 1. 框架和库

- **Vue 3** - Composition API
- **TypeScript** - 类型安全
- **Naive UI** - UI组件库
- **Alova** - HTTP请求库（从项目现有的使用）

### 2. 核心特性

#### 响应式数据管理
```typescript
const tableData = ref<Api.Order.OrderInfo[]>([])
const formModel = reactive(formDefault())
```

#### 步骤器实现
```typescript
const currentStep = ref(0) // 0, 1, 2

// 步骤1完成后进入步骤2
async function handleStep1() {
  const res = await createOrder(...)
  formModel.id = res.data.order.id
  currentStep.value = 1
}
```

#### 动态表格
```typescript
// 自动生成颜色+尺码组合
function generateOrderItems() {
  const items: Api.Order.OrderItem[] = []
  formModel.colors.forEach((colorId) => {
    formModel.sizes.forEach((sizeId) => {
      items.push({
        color_id: colorId,
        color_name: getColorName(colorId),
        size_id: sizeId,
        size_name: getSizeName(sizeId),
        quantity: 0,
      })
    })
  })
  formModel.items = items
}
```

#### 联动逻辑
```typescript
// 选择款式时自动加载关联数据
function onStyleChange(styleId: string) {
  const style = styleOptions.value.find(s => s.value === styleId)
  if (style) {
    formModel.colors = style.colors
    formModel.sizes = style.sizes
    formModel.unit_price = style.unit_price
    formModel.procedures = style.procedures
    generateOrderItems()
  }
}
```

### 3. 组件复用

#### 表格Modal模式
```typescript
type ModalType = 'add' | 'edit' | 'view'

function openModal(type: ModalType, data?: any) {
  showModal()
  modalType.value = type
  if (type === 'edit' || type === 'view') {
    Object.assign(formModel, data)
  }
}
```

#### 自定义Hooks
```typescript
const { bool: loading, setTrue: startLoading, setFalse: endLoading } = useBoolean(false)
```

### 4. 表单验证

```typescript
const rules = {
  contract_no: { required: true, message: '请输入合同号', trigger: 'blur' },
  customer_id: { required: true, message: '请选择客户', trigger: 'change' },
  style_no: { required: true, message: '请输入款号', trigger: 'blur' },
  style_name: { required: true, message: '请输入款名', trigger: 'blur' },
}

await formRef.value?.validate()
```

### 5. 错误处理

```typescript
try {
  const res = await fetchOrderList(params)
  tableData.value = res.data.orders || []
}
catch (error: any) {
  window.$message.error(error.message || '获取订单列表失败')
}
finally {
  endLoading()
}
```

## 界面布局

### 订单列表页面

```
┌─────────────────────────────────────────────────────┐
│ 订单管理                                             │
├─────────────────────────────────────────────────────┤
│ [搜索框] [搜索框] [下拉] [查询] [重置]  [新建] [删除]│
├─────────────────────────────────────────────────────┤
│ ☑ │图片│合同号│客户│款号│数量│...│操作              │
│ ☐ │🖼️ │001  │客户A│S01│450│...│[详情][编辑][复制]│
│ ☐ │🖼️ │002  │客户B│S02│300│...│[详情][编辑][复制]│
├─────────────────────────────────────────────────────┤
│                            [1] 2 3 4 5 > 每页10条 ▼ │
└─────────────────────────────────────────────────────┘
```

### 订单创建弹窗（三步骤）

```
┌─────────────────────────────────────────┐
│ 新建订单                          [X]    │
├─────────────────────────────────────────┤
│ ① 基础信息  →  ② 款式数量  →  ③ 工序清单│
├─────────────────────────────────────────┤
│ 合同号: [__________]                    │
│ 客户:   [下拉选择▼]                      │
│ 交货:   [日期选择📅]                     │
│ 类型:   [下拉选择▼]                      │
│ 业务员: [下拉选择▼]                      │
│ 备注:   [________________]              │
│         [________________]              │
├─────────────────────────────────────────┤
│                   [取消]  [下一步]      │
└─────────────────────────────────────────┘
```

### 款式编辑弹窗（标签页）

```
┌─────────────────────────────────────────┐
│ 编辑款式                          [X]    │
├─────────────────────────────────────────┤
│ 基础信息 │ 颜色尺码 │ 工序清单           │
├─────────────────────────────────────────┤
│ 款号: [0031214]     (不可修改)          │
│ 款名: [测试款式]                         │
│ 分类: [春装]                             │
│ 单价: [2.00]                            │
│ 状态: ⦿启用 ○禁用                       │
├─────────────────────────────────────────┤
│                   [取消]  [确定]        │
└─────────────────────────────────────────┘
```

## 文件清单

### 新增文件

```
frontend/src/
├── typings/api/
│   └── order.d.ts                      # 订单类型定义（230行）
├── service/api/
│   └── order.ts                        # 订单API服务（73行）
├── views/order/
│   ├── orders/
│   │   ├── index.vue                   # 订单列表页面（280行）
│   │   └── components/
│   │       └── TableModal.vue          # 订单编辑弹窗（460行）
│   ├── styles/
│   │   ├── index.vue                   # 款式列表页面（240行）
│   │   └── components/
│   │       └── TableModal.vue          # 款式编辑弹窗（360行）
│   └── README.md                       # 模块说明文档
└── service/
    └── index.ts                        # 导出order API（已更新）
```

### 修改文件

```
frontend/src/service/index.ts          # 添加order API导出
```

## 使用说明

### 1. 访问页面

假设路由已配置：
- 订单管理：`/order/orders`
- 款式管理：`/order/styles`

### 2. 创建订单

1. 点击"新建订单"按钮
2. 填写基础信息（合同号、客户等）→ 点击"下一步"
3. 选择款式，配置颜色尺码数量 → 点击"下一步"
4. 查看/编辑工序清单 → 点击"完成"

### 3. 创建款式

1. 点击"新建款式"按钮
2. 在"基础信息"标签填写款号、款名等
3. 在"颜色尺码"标签选择颜色和尺码
4. 在"工序清单"标签配置工序
5. 点击"确定"保存

### 4. 编辑和删除

- 点击列表中的"编辑"按钮修改
- 点击"删除"按钮删除（会弹出确认提示）
- 支持批量删除：勾选多行，点击"批量删除"

## 特色功能

### 1. 三步骤创建订单

采用步骤器（NSteps）引导用户完成订单创建：
- 每一步都会保存数据到后端
- 可以返回上一步修改
- 清晰的流程指示

### 2. 智能关联

选择款式后自动加载：
- 款式的颜色和尺码
- 款式的单价
- 款式的工序清单
- 自动生成颜色+尺码组合表格

### 3. 动态表格

- 颜色尺码数量配置：自动生成所有组合
- 工序清单：支持增删改查、排序
- 表格内嵌表单组件

### 4. 状态管理

- 订单状态用不同颜色标签显示
- 款式启用/禁用状态清晰标识
- 进度百分比显示

### 5. 复制功能

一键复制现有订单创建新订单，加快录入速度

## 后续扩展

- [ ] 图片上传功能
- [ ] 订单详情页（多标签）
  - [ ] 订单信息
  - [ ] 裁片监控
  - [ ] 进度监控
  - [ ] 订单白示（甘特图）
  - [ ] 计件工资
- [ ] 裁剪制菲打印
- [ ] 批量导入
- [ ] 导出Excel
- [ ] 订单统计图表
- [ ] 高级搜索（更多筛选条件）
- [ ] 订单状态流转审核

## 总结

✅ **已完成：**

**后端：**
- ✅ 完整的数据模型（Order、Style、CuttingBatch）
- ✅ Repository层（数据访问）
- ✅ Service层（业务逻辑）
- ✅ Endpoint层（go-kit）
- ✅ Transport层（HTTP处理）
- ✅ 三步骤订单创建API
- ✅ 租户数据隔离
- ✅ 中间件支持
- ✅ Consul服务注册

**前端：**
- ✅ 完整的TypeScript类型定义
- ✅ HTTP API服务封装
- ✅ 订单管理页面（列表+三步骤创建）
- ✅ 款式管理页面（列表+三标签页编辑）
- ✅ 多条件搜索和分页
- ✅ 批量操作
- ✅ 表单验证
- ✅ 错误处理
- ✅ 响应式布局

**文档：**
- ✅ API文档
- ✅ 后端实现文档
- ✅ 前端实现文档
- ✅ 模块README

订单服务的前后端实现已全部完成，可以直接投入使用！🎉
