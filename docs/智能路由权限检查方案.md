# æ™ºèƒ½è·¯ç”±æƒé™æ£€æŸ¥æ–¹æ¡ˆ âœ¨

## ğŸ’¡ æ ¸å¿ƒæ€æƒ³

**ä»è·¯ç”±è·¯å¾„è‡ªåŠ¨è¯†åˆ«ä¸šåŠ¡åŠ¨ä½œï¼Œæ— éœ€åœ¨ä¸šåŠ¡ä»£ç ä¸­æ‰‹åŠ¨æ£€æŸ¥æƒé™ï¼**

## ğŸ¯ è®¾è®¡åŸç†

### æ™ºèƒ½è§£æè§„åˆ™

```go
// è§„åˆ™1ï¼šä¸šåŠ¡åŠ¨ä½œè·¯å¾„
POST /finance/pending  â†’ resource="/finance", action="pending"
POST /finance/verify   â†’ resource="/finance", action="verify"
POST /workflow/approve â†’ resource="/workflow", action="approve"

// è§„åˆ™2ï¼šRESTful è·¯å¾„
GET    /finance        â†’ resource="/finance", action="read"
POST   /finance        â†’ resource="/finance", action="create"
PUT    /finance/:id    â†’ resource="/finance/:id", action="update"
DELETE /finance/:id    â†’ resource="/finance/:id", action="delete"
```

### åˆ¤æ–­é€»è¾‘

```
1. æå–è·¯å¾„æœ€åä¸€æ®µ
2. åˆ¤æ–­æ˜¯å¦æ˜¯ä¸šåŠ¡åŠ¨ä½œï¼š
   âœ… ä¸æ˜¯æ•°å­—/UUID/ObjectID
   âœ… åœ¨é¢„å®šä¹‰çš„ä¸šåŠ¡åŠ¨ä½œåˆ—è¡¨ä¸­
3. å¦‚æœæ˜¯ä¸šåŠ¡åŠ¨ä½œï¼š
   â†’ resource = å»æ‰æœ€åä¸€æ®µçš„è·¯å¾„
   â†’ action = æœ€åä¸€æ®µ
4. å¦åˆ™ï¼š
   â†’ resource = å®Œæ•´è·¯å¾„
   â†’ action = HTTPæ–¹æ³•æ˜ å°„
```

## ğŸ“¦ å®æˆ˜ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šè´¢åŠ¡æ¨¡å—

#### 1. è·¯ç”±é…ç½®

```go
// cmd/gateway/main.go

func setupFinanceRoutes(r *gin.RouterGroup) {
    finance := r.Group("/finance")
    {
        // RESTful é£æ ¼ï¼ˆåŸºç¡€ CRUDï¼‰
        finance.GET("", financeHandler.List)             // â†’ read
        finance.GET("/:id", financeHandler.Get)          // â†’ read
        finance.POST("", financeHandler.Create)          // â†’ create
        finance.PUT("/:id", financeHandler.Update)       // â†’ update
        finance.DELETE("/:id", financeHandler.Delete)    // â†’ delete
        
        // ä¸šåŠ¡åŠ¨ä½œè·¯å¾„ï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼ï¼‰
        finance.POST("/pending", financeHandler.Pending)  // â†’ pending âœ¨
        finance.POST("/verify", financeHandler.Verify)    // â†’ verify âœ¨
        finance.POST("/audit", financeHandler.Audit)      // â†’ audit âœ¨
        finance.POST("/export", financeHandler.Export)    // â†’ export âœ¨
    }
}
```

#### 2. Handler å®ç°ï¼ˆæ— éœ€æ‰‹åŠ¨æ£€æŸ¥æƒé™ï¼ï¼‰

```go
// app/finance/transport/finance.go

// PendingHandler æŒ‚è´¦ï¼ˆGateway å·²ç»æ£€æŸ¥äº† pending æƒé™ï¼‰
func PendingHandler(financeSvc *services.FinanceService) gin.HandlerFunc {
    return func(c *gin.Context) {
        var req dto.PendingRequest
        if err := c.ShouldBindJSON(&req); err != nil {
            response.Error(c, "å‚æ•°é”™è¯¯")
            return
        }
        
        // âœ… æ— éœ€æ‰‹åŠ¨æ£€æŸ¥æƒé™ï¼Gateway å·²æ£€æŸ¥
        // âŒ ä¸å†éœ€è¦ï¼šcasbin.CheckUserPermission(...)
        
        // ç›´æ¥æ‰§è¡Œä¸šåŠ¡é€»è¾‘
        err := financeSvc.PendingOrder(c.Request.Context(), req.OrderID)
        if err != nil {
            response.Error(c, err.Error())
            return
        }
        
        response.SuccessWithMsg(c, "æŒ‚è´¦æˆåŠŸ", nil)
    }
}

// VerifyHandler æ ¸é”€ï¼ˆGateway å·²ç»æ£€æŸ¥äº† verify æƒé™ï¼‰
func VerifyHandler(financeSvc *services.FinanceService) gin.HandlerFunc {
    return func(c *gin.Context) {
        var req dto.VerifyRequest
        if err := c.ShouldBindJSON(&req); err != nil {
            response.Error(c, "å‚æ•°é”™è¯¯")
            return
        }
        
        // âœ… æ— éœ€æ‰‹åŠ¨æ£€æŸ¥æƒé™ï¼
        err := financeSvc.VerifyOrder(c.Request.Context(), req.OrderID)
        if err != nil {
            response.Error(c, err.Error())
            return
        }
        
        response.SuccessWithMsg(c, "æ ¸é”€æˆåŠŸ", nil)
    }
}
```

#### 3. Service å®ç°ï¼ˆçº¯ä¸šåŠ¡é€»è¾‘ï¼‰

```go
// app/finance/services/finance.go

// PendingOrder æŒ‚è´¦ï¼ˆçº¯ä¸šåŠ¡é€»è¾‘ï¼Œæ— æƒé™æ£€æŸ¥ï¼‰
func (s *FinanceService) PendingOrder(ctx context.Context, orderID string) error {
    order, err := s.orderRepo.GetByID(ctx, orderID)
    if err != nil {
        return fmt.Errorf("è®¢å•ä¸å­˜åœ¨: %w", err)
    }
    
    if order.Status == "pending" {
        return fmt.Errorf("è®¢å•å·²ç»æ˜¯æŒ‚è´¦çŠ¶æ€")
    }
    
    updates := map[string]interface{}{
        "status":     "pending",
        "updated_at": time.Now().Unix(),
    }
    
    return s.orderRepo.Update(ctx, orderID, updates)
}

// VerifyOrder æ ¸é”€ï¼ˆçº¯ä¸šåŠ¡é€»è¾‘ï¼Œæ— æƒé™æ£€æŸ¥ï¼‰
func (s *FinanceService) VerifyOrder(ctx context.Context, orderID string) error {
    order, err := s.orderRepo.GetByID(ctx, orderID)
    if err != nil {
        return fmt.Errorf("è®¢å•ä¸å­˜åœ¨: %w", err)
    }
    
    if order.Status != "pending" {
        return fmt.Errorf("åªèƒ½æ ¸é”€æŒ‚è´¦çŠ¶æ€çš„è®¢å•")
    }
    
    updates := map[string]interface{}{
        "status":     "verified",
        "updated_at": time.Now().Unix(),
    }
    
    return s.orderRepo.Update(ctx, orderID, updates)
}
```

### ç¤ºä¾‹2ï¼šå·¥ä½œæµæ¨¡å—

#### è·¯ç”±é…ç½®

```go
func setupWorkflowRoutes(r *gin.RouterGroup) {
    workflow := r.Group("/workflow")
    {
        workflow.GET("", workflowHandler.List)                // â†’ read
        workflow.POST("", workflowHandler.Create)             // â†’ create
        
        // ä¸šåŠ¡åŠ¨ä½œ
        workflow.POST("/approve", workflowHandler.Approve)    // â†’ approve âœ¨
        workflow.POST("/reject", workflowHandler.Reject)      // â†’ reject âœ¨
        workflow.POST("/submit", workflowHandler.Submit)      // â†’ submit âœ¨
        workflow.POST("/withdraw", workflowHandler.Withdraw)  // â†’ withdraw âœ¨
    }
}
```

#### Handlerï¼ˆæ— éœ€æƒé™æ£€æŸ¥ï¼‰

```go
func ApproveHandler(workflowSvc *services.WorkflowService) gin.HandlerFunc {
    return func(c *gin.Context) {
        var req dto.ApproveRequest
        if err := c.ShouldBindJSON(&req); err != nil {
            response.Error(c, "å‚æ•°é”™è¯¯")
            return
        }
        
        // âœ… Gateway å·²æ£€æŸ¥ approve æƒé™
        err := workflowSvc.ApproveTask(c.Request.Context(), req.TaskID)
        if err != nil {
            response.Error(c, err.Error())
            return
        }
        
        response.SuccessWithMsg(c, "å®¡æ‰¹æˆåŠŸ", nil)
    }
}
```

## ğŸ” æƒé™æ£€æŸ¥æµç¨‹

### å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¯·æ±‚: POST /admin/finance/pending                     â”‚
â”‚  Body: { "orderId": "123" }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway Casbin ä¸­é—´ä»¶                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  parseResourceAndAction()                            â”‚  â”‚
â”‚  â”‚  1. å»æ‰å‰ç¼€: /finance/pending                       â”‚  â”‚
â”‚  â”‚  2. æå–æœ€åä¸€æ®µ: "pending"                          â”‚  â”‚
â”‚  â”‚  3. åˆ¤æ–­: isBusinessAction("pending") â†’ true âœ…      â”‚  â”‚
â”‚  â”‚  4. è§£æç»“æœ:                                        â”‚  â”‚
â”‚  â”‚     resource = "/finance"                            â”‚  â”‚
â”‚  â”‚     action = "pending"                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  CheckPermission()                                   â”‚  â”‚
â”‚  â”‚  - æ£€æŸ¥: user èƒ½å¦å¯¹ "/finance" æ‰§è¡Œ "pending"      â”‚  â”‚
â”‚  â”‚  - æŸ¥è¯¢ Casbin: p, user:xxx, /finance, pending      â”‚  â”‚
â”‚  â”‚  - ç»“æœ: âœ… å…è®¸                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è·¯ç”±åˆ° Handler: PendingHandler()                          â”‚
â”‚  - è§£æè¯·æ±‚å‚æ•°                                            â”‚
â”‚  - è°ƒç”¨ Service: financeSvc.PendingOrder(orderId)         â”‚
â”‚  - è¿”å›ç»“æœ                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service å±‚: PendingOrder()                                â”‚
â”‚  âœ… æ— éœ€æƒé™æ£€æŸ¥ï¼ç›´æ¥æ‰§è¡Œä¸šåŠ¡é€»è¾‘                         â”‚
â”‚  - æŸ¥è¯¢è®¢å•                                                â”‚
â”‚  - éªŒè¯ä¸šåŠ¡è§„åˆ™                                            â”‚
â”‚  - æ›´æ–°è®¢å•çŠ¶æ€                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ—¥å¿—è¾“å‡ºç¤ºä¾‹

```bash
[Casbin] æ£€æµ‹åˆ°ä¸šåŠ¡åŠ¨ä½œ: POST /finance/pending â†’ resource=/finance, action=pending
[Casbin] æƒé™é€šè¿‡: user=user123, resource=/finance, action=pending
```

## ğŸ“ æ”¯æŒçš„ä¸šåŠ¡åŠ¨ä½œåˆ—è¡¨

ä¸­é—´ä»¶é¢„å®šä¹‰äº†å¸¸è§çš„ä¸šåŠ¡åŠ¨ä½œï¼ˆå¯æ‰©å±•ï¼‰ï¼š

| åŠ¨ä½œ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|-----|------|---------|
| `pending` | æŒ‚è´¦ | è´¢åŠ¡æ¨¡å— |
| `verify` | æ ¸é”€ | è´¢åŠ¡æ¨¡å— |
| `approve` | æ‰¹å‡† | å·¥ä½œæµ |
| `reject` | æ‹’ç» | å·¥ä½œæµ |
| `audit` | å®¡æ ¸ | è´¢åŠ¡/å®¡æ‰¹ |
| `export` | å¯¼å‡º | æŠ¥è¡¨ |
| `import` | å¯¼å…¥ | æ•°æ®å¯¼å…¥ |
| `publish` | å‘å¸ƒ | å†…å®¹ç®¡ç† |
| `cancel` | å–æ¶ˆ | è®¢å•ç®¡ç† |
| `close` | å…³é—­ | å·¥å•ç®¡ç† |
| `submit` | æäº¤ | è¡¨å•/å·¥ä½œæµ |
| `withdraw` | æ’¤å› | å·¥ä½œæµ |
| `assign` | åˆ†é… | ä»»åŠ¡ç®¡ç† |
| `transfer` | è½¬ç§» | æƒé™/èµ„æº |
| `lock` | é”å®š | è´¦æˆ·ç®¡ç† |
| `unlock` | è§£é” | è´¦æˆ·ç®¡ç† |
| `enable` | å¯ç”¨ | åŠŸèƒ½å¼€å…³ |
| `disable` | ç¦ç”¨ | åŠŸèƒ½å¼€å…³ |

### æ·»åŠ è‡ªå®šä¹‰ä¸šåŠ¡åŠ¨ä½œ

ç¼–è¾‘ `app/gateway/middleware/casbin_auth.go`ï¼š

```go
func isBusinessAction(segment string) bool {
    // ... å·²æœ‰çš„ ID æ ¼å¼åˆ¤æ–­ ...
    
    businessActions := map[string]bool{
        // ... å·²æœ‰åŠ¨ä½œ ...
        
        // æ·»åŠ ä½ çš„è‡ªå®šä¹‰åŠ¨ä½œ
        "settle":    true, // ç»“ç®—
        "reconcile": true, // å¯¹è´¦
        "refund":    true, // é€€æ¬¾
    }
    
    return businessActions[segment]
}
```

## ğŸ¨ å‰ç«¯é›†æˆ

å‰ç«¯ API è°ƒç”¨ï¼š

```typescript
// api/finance.ts

// æŒ‚è´¦
export function pendingOrder(orderId: string) {
  return request.Post<Service.ResponseResult>('/finance/pending', { orderId })
}

// æ ¸é”€
export function verifyOrder(orderId: string) {
  return request.Post<Service.ResponseResult>('/finance/verify', { orderId })
}

// å¯¼å‡º
export function exportReport(params: any) {
  return request.Post<Blob>('/finance/export', params, {
    responseType: 'blob'
  })
}
```

å‰ç«¯é¡µé¢ï¼š

```vue
<script setup lang="ts">
import { usePermission } from '@/hooks'
import { pendingOrder, verifyOrder } from '@/service/api/finance'

const { hasAction } = usePermission()

async function handlePending(row: any) {
  await pendingOrder(row.id)
  window.$message.success('æŒ‚è´¦æˆåŠŸ')
}

async function handleVerify(row: any) {
  await verifyOrder(row.id)
  window.$message.success('æ ¸é”€æˆåŠŸ')
}
</script>

<template>
  <!-- æƒé™æ§åˆ¶ -->
  <NButton v-if="hasAction('finance', 'pending')" @click="handlePending(row)">
    æŒ‚è´¦
  </NButton>
  
  <NButton v-if="hasAction('finance', 'verify')" @click="handleVerify(row)">
    æ ¸é”€
  </NButton>
</template>
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. è·¯ç”±å‘½åè§„èŒƒ

âœ… **æ¨è**ï¼šä½¿ç”¨æ¸…æ™°çš„ä¸šåŠ¡åŠ¨ä½œè¯
```go
finance.POST("/pending", handler)   // æŒ‚è´¦
finance.POST("/verify", handler)    // æ ¸é”€
workflow.POST("/approve", handler)  // æ‰¹å‡†
```

âŒ **ä¸æ¨è**ï¼šä½¿ç”¨æ¨¡ç³Šçš„åŠ¨è¯
```go
finance.POST("/action", handler)     // å¤ªæ¨¡ç³Š
finance.POST("/do", handler)         // ä¸æ˜ç¡®
finance.POST("/handle", handler)     // ä¸æ¸…æ™°
```

### 2. é¿å…è·¯å¾„å†²çª

å¦‚æœä½ æœ‰ä¸€ä¸ªèµ„æºå« `pending`ï¼š

```go
// âŒ å†²çªï¼
finance.GET("/pending", handler)        // æ˜¯æŸ¥è¯¢ pending èµ„æºï¼Ÿ
finance.POST("/pending", handler)       // è¿˜æ˜¯æ‰§è¡Œ pending åŠ¨ä½œï¼Ÿ

// âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å­è·¯ç”±
finance.GET("/pendings", handler)       // æŸ¥è¯¢ pending èµ„æºåˆ—è¡¨
finance.POST("/order/pending", handler) // è®¢å•æŒ‚è´¦åŠ¨ä½œ
```

### 3. ID è·¯å¾„ä¸ä¼šè¢«è¯†åˆ«ä¸ºä¸šåŠ¡åŠ¨ä½œ

```go
// âœ… è¿™äº›ä¼šè¢«è¯†åˆ«ä¸º RESTfulï¼Œä¸æ˜¯ä¸šåŠ¡åŠ¨ä½œ
finance.GET("/68dd0d911adf4a854a8a9f66")    // ObjectID
finance.PUT("/123")                         // æ•°å­—ID
finance.DELETE("/550e8400-e29b-41d4-a716-446655440000")  // UUID

// âœ… è¿™äº›ä¼šè¢«è¯†åˆ«ä¸ºä¸šåŠ¡åŠ¨ä½œ
finance.POST("/pending")
finance.POST("/verify")
```

## ğŸ‰ ä¼˜åŠ¿æ€»ç»“

### å¯¹æ¯”æ—§æ–¹æ¡ˆ

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|-----|------|------|
| **æ—§æ–¹æ¡ˆ**ï¼š<br/>ä¸šåŠ¡ä»£ç æ‰‹åŠ¨æ£€æŸ¥ | - çµæ´» | âŒ ä»£ç å†—ä½™<br/>âŒ å®¹æ˜“é—æ¼<br/>âŒ ä¸ç»Ÿä¸€ |
| **æ–°æ–¹æ¡ˆ**ï¼š<br/>è·¯ç”±è‡ªåŠ¨è¯†åˆ« | âœ… è‡ªåŠ¨åŒ–<br/>âœ… ç»Ÿä¸€ç®¡ç†<br/>âœ… ä»£ç ç®€æ´<br/>âœ… ä¸æ˜“å‡ºé”™ | - éœ€è¦éµå¾ªå‘½åè§„èŒƒ |

### ä»£ç é‡å¯¹æ¯”

```go
// âŒ æ—§æ–¹æ¡ˆï¼šæ¯ä¸ªæ–¹æ³•éƒ½è¦æ‰‹åŠ¨æ£€æŸ¥
func (s *FinanceService) PendingOrder(ctx context.Context, userID, tenantID, orderID string) error {
    // æ‰‹åŠ¨æ£€æŸ¥æƒé™ï¼ˆé‡å¤ä»£ç ï¼‰
    if !casbin.CheckUserPermission(tenantID, userID, "/finance", "pending") {
        return fmt.Errorf("æ— æŒ‚è´¦æƒé™")
    }
    // ä¸šåŠ¡é€»è¾‘...
}

func (s *FinanceService) VerifyOrder(ctx context.Context, userID, tenantID, orderID string) error {
    // åˆè¦æ‰‹åŠ¨æ£€æŸ¥æƒé™ï¼ˆé‡å¤ä»£ç ï¼‰
    if !casbin.CheckUserPermission(tenantID, userID, "/finance", "verify") {
        return fmt.Errorf("æ— æ ¸é”€æƒé™")
    }
    // ä¸šåŠ¡é€»è¾‘...
}

// âœ… æ–°æ–¹æ¡ˆï¼šGateway è‡ªåŠ¨æ£€æŸ¥ï¼Œä¸šåŠ¡ä»£ç ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘
func (s *FinanceService) PendingOrder(ctx context.Context, orderID string) error {
    // ç›´æ¥ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€æƒé™æ£€æŸ¥
    // ...
}

func (s *FinanceService) VerifyOrder(ctx context.Context, orderID string) error {
    // ç›´æ¥ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€æƒé™æ£€æŸ¥
    // ...
}
```

**ä»£ç å‡å°‘äº† 30-40%ï¼** ğŸŠ

## ğŸš€ ç«‹å³ä½¿ç”¨

1. âœ… Gateway ä¸­é—´ä»¶å·²æ›´æ–°ï¼Œè‡ªåŠ¨ç”Ÿæ•ˆ
2. âœ… æŒ‰ç…§è§„èŒƒå‘½åè·¯ç”±ï¼š`POST /resource/action`
3. âœ… Handler å’Œ Service æ— éœ€æ‰‹åŠ¨æ£€æŸ¥æƒé™
4. âœ… äº«å—ç®€æ´ä¼˜é›…çš„ä»£ç ï¼

---

**è¿™æ‰æ˜¯çœŸæ­£çš„ä¼˜é›…ï¼** ğŸ˜

