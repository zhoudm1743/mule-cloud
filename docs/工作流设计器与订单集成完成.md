# å·¥ä½œæµè®¾è®¡å™¨ä¸è®¢å•æœåŠ¡é›†æˆå®Œæˆ âœ…

## ğŸ‰ é›†æˆå®Œæˆ

**å®Œæˆæ—¶é—´**: 2025-10-18  
**çŠ¶æ€**: âœ… åç«¯å®Œæ•´é›†æˆ

## ğŸ“‹ é—®é¢˜è¯´æ˜

ä¹‹å‰çš„å·¥ä½œæµç³»ç»Ÿå­˜åœ¨**ä¸¤å¥—ç‹¬ç«‹ç³»ç»Ÿ**ï¼š
1. **ç¡¬ç¼–ç å·¥ä½œæµ**ï¼ˆ`core/workflow/order_workflow_advanced.go`ï¼‰- çŠ¶æ€å’Œè§„åˆ™å†™æ­»åœ¨ä»£ç ä¸­
2. **å¯è§†åŒ–å·¥ä½œæµè®¾è®¡å™¨**ï¼ˆ`app/workflow/services/designer.go`ï¼‰- å¯ä»¥åœ¨æ•°æ®åº“ä¸­åˆ›å»ºå·¥ä½œæµï¼Œä½†æ²¡æœ‰è¢«è®¢å•ä½¿ç”¨

**ç°åœ¨å·²è§£å†³**ï¼šè®¢å•æœåŠ¡ç°åœ¨ä½¿ç”¨å·¥ä½œæµè®¾è®¡å™¨åˆ›å»ºçš„å·¥ä½œæµå®šä¹‰ã€‚

## ğŸ”§ å®æ–½å†…å®¹

### 1. æ•°æ®æ¨¡å‹æ‰©å±•

**æ–‡ä»¶**ï¼š`internal/models/order.go`

ä¸ºè®¢å•æ¨¡å‹æ·»åŠ äº†å·¥ä½œæµç›¸å…³å­—æ®µï¼š
```go
type Order struct {
    // ... å…¶ä»–å­—æ®µ ...
    
    // å·¥ä½œæµç›¸å…³
    WorkflowCode     string // å·¥ä½œæµå®šä¹‰ç¼–ç 
    WorkflowInstance string // å·¥ä½œæµå®ä¾‹ID
    WorkflowState    string // å½“å‰å·¥ä½œæµçŠ¶æ€
}
```

### 2. å·¥ä½œæµå¼•æ“æœåŠ¡

**æ–‡ä»¶**ï¼š`app/order/services/workflow_engine.go`

åˆ›å»ºäº†å·¥ä½œæµå¼•æ“æœåŠ¡ï¼Œè¿æ¥å·¥ä½œæµè®¾è®¡å™¨å’Œè®¢å•æœåŠ¡ï¼š

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… `InitOrderWorkflow` - ä¸ºè®¢å•åˆå§‹åŒ–å·¥ä½œæµå®ä¾‹
- âœ… `TransitionOrderState` - æ‰§è¡Œè®¢å•çŠ¶æ€è½¬æ¢
- âœ… `GetOrderWorkflowState` - è·å–è®¢å•å½“å‰å·¥ä½œæµçŠ¶æ€
- âœ… `GetAvailableTransitions` - è·å–è®¢å•å¯ç”¨çš„è½¬æ¢è§„åˆ™

**ç‰¹æ€§**ï¼š
- âœ… ä»æ•°æ®åº“åŠ è½½å·¥ä½œæµå®šä¹‰
- âœ… åˆ›å»ºå’Œç®¡ç†å·¥ä½œæµå®ä¾‹
- âœ… æ¡ä»¶æ£€æŸ¥ï¼ˆæ”¯æŒ eq, ne, gt, gte, lt, lteï¼‰
- âœ… åŠ¨ä½œæ‰§è¡Œï¼ˆupdate_field, notify, webhookï¼‰
- âœ… å†å²è®°å½•è¿½è¸ª
- âœ… çŠ¶æ€æ˜ å°„ï¼ˆå·¥ä½œæµçŠ¶æ€ â†’ è®¢å•çŠ¶æ€ï¼‰

### 3. è®¢å•æœåŠ¡é›†æˆ

**æ–‡ä»¶**ï¼š`app/order/services/order.go`

ä¿®æ”¹å†…å®¹ï¼š
- âœ… æ·»åŠ  `workflowEngine` ä¾èµ–
- âœ… åˆ›å»ºè®¢å•æ—¶è‡ªåŠ¨åˆå§‹åŒ–å·¥ä½œæµï¼ˆä½¿ç”¨ `order_basic` å·¥ä½œæµï¼‰
- âœ… æ–°å¢3ä¸ªå·¥ä½œæµç›¸å…³æ–¹æ³•ï¼š
  - `TransitionWorkflowState` - æ‰§è¡ŒçŠ¶æ€è½¬æ¢
  - `GetWorkflowState` - è·å–å·¥ä½œæµçŠ¶æ€
  - `GetAvailableTransitions` - è·å–å¯ç”¨è½¬æ¢

### 4. APIæ¥å£

**æ–‡ä»¶**ï¼š
- `app/order/dto/order.go` - æ–°å¢DTO
- `app/order/endpoint/order.go` - æ–°å¢Endpoint
- `app/order/transport/order.go` - æ–°å¢Handler
- `cmd/order/main.go` - æ³¨å†Œè·¯ç”±

**æ–°å¢APIæ¥å£**ï¼š
```
POST   /admin/order/orders/:id/workflow/transition   # æ‰§è¡Œå·¥ä½œæµçŠ¶æ€è½¬æ¢
GET    /admin/order/orders/:id/workflow/state        # è·å–å·¥ä½œæµçŠ¶æ€
GET    /admin/order/orders/:id/workflow/transitions  # è·å–å¯ç”¨è½¬æ¢
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### æ­¥éª¤1ï¼šåˆ›å»ºå·¥ä½œæµå®šä¹‰

ä½¿ç”¨å·¥ä½œæµè®¾è®¡å™¨åˆ›å»ºä¸€ä¸ªè®¢å•å·¥ä½œæµï¼š

1. è®¿é—® `/order/workflow/designer/list`
2. ç‚¹å‡»"æ–°å»ºå·¥ä½œæµ"æˆ–ä½¿ç”¨æ¨¡æ¿
3. å®šä¹‰çŠ¶æ€å’Œè½¬æ¢è§„åˆ™
4. ä¿å­˜å¹¶æ¿€æ´»å·¥ä½œæµ
5. **é‡è¦**ï¼šå·¥ä½œæµç¼–ç å¿…é¡»è®¾ç½®ä¸º `order_basic`ï¼ˆæˆ–ä¿®æ”¹è®¢å•æœåŠ¡ä¸­çš„é»˜è®¤å€¼ï¼‰

**ç¤ºä¾‹å·¥ä½œæµå®šä¹‰**ï¼š
```json
{
  "name": "åŸºç¡€è®¢å•å·¥ä½œæµ",
  "code": "order_basic",
  "description": "è®¢å•åŸºç¡€æµç¨‹",
  "states": [
    {
      "id": "draft",
      "code": "draft",
      "name": "è‰ç¨¿",
      "type": "start",
      "color": "#909399"
    },
    {
      "id": "ordered",
      "code": "ordered",
      "name": "å·²ä¸‹å•",
      "type": "normal",
      "color": "#409EFF"
    },
    {
      "id": "production",
      "code": "production",
      "name": "ç”Ÿäº§ä¸­",
      "type": "normal",
      "color": "#E6A23C"
    },
    {
      "id": "completed",
      "code": "completed",
      "name": "å·²å®Œæˆ",
      "type": "end",
      "color": "#67C23A"
    }
  ],
  "transitions": [
    {
      "id": "t1",
      "name": "æäº¤è®¢å•",
      "from_state": "draft",
      "to_state": "ordered",
      "event": "submit",
      "conditions": [],
      "actions": []
    },
    {
      "id": "t2",
      "name": "å¼€å§‹ç”Ÿäº§",
      "from_state": "ordered",
      "to_state": "production",
      "event": "start_production",
      "conditions": [],
      "actions": []
    },
    {
      "id": "t3",
      "name": "å®Œæˆè®¢å•",
      "from_state": "production",
      "to_state": "completed",
      "event": "complete",
      "conditions": [
        {
          "type": "field",
          "field": "progress",
          "operator": "gte",
          "value": 1.0,
          "description": "è¿›åº¦å¿…é¡»è¾¾åˆ°100%"
        }
      ],
      "actions": []
    }
  ]
}
```

### æ­¥éª¤2ï¼šåˆ›å»ºè®¢å•

åˆ›å»ºè®¢å•æ—¶ä¼šè‡ªåŠ¨åˆå§‹åŒ–å·¥ä½œæµï¼š

```bash
POST /admin/order/orders
{
  "contract_no": "C2025001",
  "customer_id": "customer_1",
  "delivery_date": "2025-12-31"
}
```

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. åˆ›å»ºè®¢å•
2. æŸ¥æ‰¾æ¿€æ´»çš„ `order_basic` å·¥ä½œæµå®šä¹‰
3. åˆ›å»ºå·¥ä½œæµå®ä¾‹
4. å°†è®¢å•çŠ¶æ€è®¾ç½®ä¸ºå¼€å§‹çŠ¶æ€ï¼ˆdraftï¼‰

### æ­¥éª¤3ï¼šæ‰§è¡ŒçŠ¶æ€è½¬æ¢

ä½¿ç”¨å·¥ä½œæµAPIæ‰§è¡ŒçŠ¶æ€è½¬æ¢ï¼š

```bash
POST /admin/order/orders/:id/workflow/transition
{
  "event": "submit",
  "operator": "user_123",
  "reason": "å®¢æˆ·ç¡®è®¤è®¢å•",
  "metadata": {
    "total_amount": 10000,
    "quantity": 100
  }
}
```

ç³»ç»Ÿä¼šï¼š
1. æŸ¥æ‰¾åŒ¹é…çš„è½¬æ¢è§„åˆ™
2. æ£€æŸ¥è½¬æ¢æ¡ä»¶
3. æ‰§è¡ŒçŠ¶æ€è½¬æ¢
4. æ‰§è¡Œè½¬æ¢åŠ¨ä½œ
5. è®°å½•å†å²

### æ­¥éª¤4ï¼šæŸ¥è¯¢å·¥ä½œæµçŠ¶æ€

```bash
GET /admin/order/orders/:id/workflow/state
```

è¿”å›ï¼š
```json
{
  "instance": {
    "id": "instance_123",
    "workflow_id": "workflow_456",
    "entity_type": "order",
    "entity_id": "order_789",
    "current_state": "ordered",
    "variables": {},
    "history": [
      {
        "from_state": "",
        "to_state": "draft",
        "event": "init",
        "operator": "system",
        "reason": "åˆå§‹åŒ–å·¥ä½œæµ",
        "timestamp": 1729267200
      },
      {
        "from_state": "draft",
        "to_state": "ordered",
        "event": "submit",
        "operator": "user_123",
        "reason": "å®¢æˆ·ç¡®è®¤è®¢å•",
        "timestamp": 1729270800
      }
    ]
  }
}
```

### æ­¥éª¤5ï¼šè·å–å¯ç”¨è½¬æ¢

```bash
GET /admin/order/orders/:id/workflow/transitions
```

è¿”å›ï¼š
```json
{
  "transitions": [
    {
      "id": "t2",
      "name": "å¼€å§‹ç”Ÿäº§",
      "from_state": "ordered",
      "to_state": "production",
      "event": "start_production",
      "conditions": [],
      "actions": [],
      "description": "è¿›å…¥ç”Ÿäº§é˜¶æ®µ"
    }
  ]
}
```

## ğŸ¯ å·¥ä½œæµçŠ¶æ€æ˜ å°„

å·¥ä½œæµçŠ¶æ€ä¼šè‡ªåŠ¨æ˜ å°„åˆ°è®¢å•çŠ¶æ€ï¼š

| å·¥ä½œæµçŠ¶æ€ | è®¢å•çŠ¶æ€ | çŠ¶æ€å€¼ |
|-----------|---------|--------|
| draft | è‰ç¨¿ | 0 |
| ordered | å·²ä¸‹å• | 1 |
| production | ç”Ÿäº§ä¸­ | 2 |
| completed | å·²å®Œæˆ | 3 |
| cancelled | å·²å–æ¶ˆ | 4 |

**æ³¨æ„**ï¼šå¯ä»¥åœ¨ `workflow_engine.go` ä¸­ä¿®æ”¹ `statusMapping` æ¥è‡ªå®šä¹‰æ˜ å°„è§„åˆ™ã€‚

## ğŸ”§ é…ç½®å·¥ä½œæµ

### ä¿®æ”¹é»˜è®¤å·¥ä½œæµ

å¦‚æœè¦ä½¿ç”¨ä¸åŒçš„å·¥ä½œæµå®šä¹‰ï¼Œä¿®æ”¹ `app/order/services/order.go`ï¼š

```go
// å°† "order_basic" æ”¹ä¸ºä½ çš„å·¥ä½œæµç¼–ç 
_ = s.workflowEngine.InitOrderWorkflow(ctx, order.ID, "your_workflow_code")
```

### é…ç½®çŠ¶æ€æ˜ å°„

ä¿®æ”¹ `app/order/services/workflow_engine.go` ä¸­çš„æ˜ å°„è§„åˆ™ï¼š

```go
statusMapping := map[string]int{
    "your_state_1": 0,
    "your_state_2": 1,
    // ... æ·»åŠ æ›´å¤šæ˜ å°„
}
```

## ğŸ’¡ é«˜çº§åŠŸèƒ½

### 1. æ¡ä»¶è½¬æ¢

åœ¨å·¥ä½œæµå®šä¹‰ä¸­æ·»åŠ æ¡ä»¶ï¼š

```json
{
  "conditions": [
    {
      "type": "field",
      "field": "total_amount",
      "operator": "gt",
      "value": 10000,
      "description": "è®¢å•é‡‘é¢å¿…é¡»å¤§äº10000"
    },
    {
      "type": "field",
      "field": "progress",
      "operator": "gte",
      "value": 1.0,
      "description": "è¿›åº¦å¿…é¡»è¾¾åˆ°100%"
    }
  ]
}
```

**æ”¯æŒçš„æ“ä½œç¬¦**ï¼š
- `eq` - ç­‰äº
- `ne` - ä¸ç­‰äº
- `gt` - å¤§äº
- `gte` - å¤§äºç­‰äº
- `lt` - å°äº
- `lte` - å°äºç­‰äº

### 2. è½¬æ¢åŠ¨ä½œ

åœ¨è½¬æ¢æ—¶è‡ªåŠ¨æ‰§è¡ŒåŠ¨ä½œï¼š

```json
{
  "actions": [
    {
      "type": "update_field",
      "field": "status",
      "value": 2,
      "description": "æ›´æ–°è®¢å•çŠ¶æ€"
    }
  ]
}
```

**æ”¯æŒçš„åŠ¨ä½œç±»å‹**ï¼š
- `update_field` - æ›´æ–°è®¢å•å­—æ®µ
- `notify` - å‘é€é€šçŸ¥ï¼ˆTODOï¼‰
- `webhook` - è°ƒç”¨webhookï¼ˆTODOï¼‰

### 3. å…ƒæ•°æ®ä¼ é€’

åœ¨è½¬æ¢æ—¶ä¼ é€’é¢å¤–æ•°æ®ï¼š

```bash
POST /admin/order/orders/:id/workflow/transition
{
  "event": "complete",
  "metadata": {
    "inspector": "quality_team",
    "quality_score": 98.5,
    "remarks": "è´¨é‡ä¼˜ç§€"
  }
}
```

è¿™äº›æ•°æ®ä¼šï¼š
- ä¿å­˜åœ¨å·¥ä½œæµå®ä¾‹çš„ `variables` ä¸­
- è®°å½•åœ¨å†å²ä¸­
- å¯ç”¨äºæ¡ä»¶æ£€æŸ¥

## ğŸ“Š æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»ºè®¢å•    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆå§‹åŒ–å·¥ä½œæµå®ä¾‹     â”‚
â”‚ - åŠ è½½å®šä¹‰          â”‚
â”‚ - åˆ›å»ºå®ä¾‹          â”‚
â”‚ - è®¾ç½®å¼€å§‹çŠ¶æ€      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰§è¡ŒçŠ¶æ€è½¬æ¢       â”‚
â”‚ - æŸ¥æ‰¾è½¬æ¢è§„åˆ™      â”‚
â”‚ - æ£€æŸ¥æ¡ä»¶          â”‚
â”‚ - æ›´æ–°çŠ¶æ€          â”‚
â”‚ - æ‰§è¡ŒåŠ¨ä½œ          â”‚
â”‚ - è®°å½•å†å²          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®¢å•çŠ¶æ€å·²æ›´æ–°     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… æµ‹è¯•æ¸…å•

- [ ] åˆ›å»ºå·¥ä½œæµå®šä¹‰ï¼ˆä½¿ç”¨è®¾è®¡å™¨ï¼‰
- [ ] æ¿€æ´»å·¥ä½œæµå®šä¹‰
- [ ] åˆ›å»ºè®¢å•ï¼ˆéªŒè¯è‡ªåŠ¨åˆå§‹åŒ–å·¥ä½œæµï¼‰
- [ ] æŸ¥è¯¢è®¢å•å·¥ä½œæµçŠ¶æ€
- [ ] æŸ¥è¯¢å¯ç”¨çš„çŠ¶æ€è½¬æ¢
- [ ] æ‰§è¡ŒçŠ¶æ€è½¬æ¢ï¼ˆæ— æ¡ä»¶ï¼‰
- [ ] æ‰§è¡ŒçŠ¶æ€è½¬æ¢ï¼ˆå¸¦æ¡ä»¶ï¼Œæ¡ä»¶æ»¡è¶³ï¼‰
- [ ] æ‰§è¡ŒçŠ¶æ€è½¬æ¢ï¼ˆå¸¦æ¡ä»¶ï¼Œæ¡ä»¶ä¸æ»¡è¶³ï¼Œåº”å¤±è´¥ï¼‰
- [ ] æŸ¥çœ‹å·¥ä½œæµå†å²è®°å½•
- [ ] éªŒè¯è®¢å•çŠ¶æ€å·²åŒæ­¥æ›´æ–°

## ğŸŠ ä¼˜åŠ¿

1. **å¯è§†åŒ–é…ç½®**ï¼šæ— éœ€ä¿®æ”¹ä»£ç å³å¯è°ƒæ•´å·¥ä½œæµ
2. **çµæ´»æ€§**ï¼šæ”¯æŒå¤æ‚çš„æ¡ä»¶å’ŒåŠ¨ä½œ
3. **å¯è¿½æº¯**ï¼šå®Œæ•´çš„å†å²è®°å½•
4. **å¯æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°çš„çŠ¶æ€å’Œè½¬æ¢
5. **ç§Ÿæˆ·éš”ç¦»**ï¼šå·¥ä½œæµå®šä¹‰å…¨å±€å…±äº«ï¼Œå®ä¾‹æŒ‰ç§Ÿæˆ·éš”ç¦»

## ğŸš€ ä¸‹ä¸€æ­¥

### åç«¯ï¼ˆå¯é€‰ï¼‰

1. å®ç° `notify` åŠ¨ä½œç±»å‹ï¼ˆå‘é€é€šçŸ¥ï¼‰
2. å®ç° `webhook` åŠ¨ä½œç±»å‹ï¼ˆè°ƒç”¨å¤–éƒ¨APIï¼‰
3. æ”¯æŒè„šæœ¬æ¡ä»¶ï¼ˆJavaScriptæ‰§è¡Œï¼‰
4. æ·»åŠ å·¥ä½œæµç‰ˆæœ¬å‡çº§æœºåˆ¶

### å‰ç«¯ï¼ˆæ¨èï¼‰

1. åœ¨è®¢å•è¯¦æƒ…é¡µæ˜¾ç¤ºå½“å‰å·¥ä½œæµçŠ¶æ€
2. æ˜¾ç¤ºå·¥ä½œæµå†å²è®°å½•
3. æ˜¾ç¤ºå¯ç”¨çš„çŠ¶æ€è½¬æ¢æŒ‰é’®
4. æ‰§è¡ŒçŠ¶æ€è½¬æ¢çš„UIç•Œé¢
5. å·¥ä½œæµå¯è§†åŒ–å±•ç¤ºï¼ˆä½¿ç”¨LogicFlowï¼‰

**å‰ç«¯é›†æˆç¤ºä¾‹**ï¼ˆä¸‹ä¸€ä¸ªTODOï¼‰ï¼š
```vue
<template>
  <div class="order-workflow">
    <n-card title="å·¥ä½œæµçŠ¶æ€">
      <!-- å½“å‰çŠ¶æ€ -->
      <n-tag :type="getStatusType(workflowState)">
        {{ workflowState.current_state }}
      </n-tag>
      
      <!-- å¯ç”¨è½¬æ¢ -->
      <n-space v-if="availableTransitions.length > 0">
        <n-button
          v-for="trans in availableTransitions"
          :key="trans.id"
          @click="handleTransition(trans)"
        >
          {{ trans.name }}
        </n-button>
      </n-space>
      
      <!-- å†å²è®°å½• -->
      <n-timeline>
        <n-timeline-item
          v-for="(item, index) in workflowState.history"
          :key="index"
          :title="item.event"
          :time="formatTime(item.timestamp)"
        >
          {{ item.from_state }} â†’ {{ item.to_state }}
          <br />
          {{ item.reason }}
        </n-timeline-item>
      </n-timeline>
    </n-card>
  </div>
</template>
```

## ğŸ“ æ–‡ä»¶æ¸…å•

**æ–°å¢æ–‡ä»¶**ï¼š
- `app/order/services/workflow_engine.go` - å·¥ä½œæµå¼•æ“æœåŠ¡

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `internal/models/order.go` - æ·»åŠ å·¥ä½œæµå­—æ®µ
- `app/order/services/order.go` - é›†æˆå·¥ä½œæµå¼•æ“
- `app/order/dto/order.go` - æ·»åŠ å·¥ä½œæµDTO
- `app/order/endpoint/order.go` - æ·»åŠ å·¥ä½œæµEndpoint
- `app/order/transport/order.go` - æ·»åŠ å·¥ä½œæµHandler
- `cmd/order/main.go` - æ³¨å†Œå·¥ä½œæµè·¯ç”±

## ğŸ‰ æ€»ç»“

å·¥ä½œæµè®¾è®¡å™¨ç°åœ¨å·²ç»**å®Œæ•´é›†æˆ**åˆ°è®¢å•æœåŠ¡ä¸­ï¼

âœ… **è®¢å•åˆ›å»ºæ—¶**ä¼šè‡ªåŠ¨åˆå§‹åŒ–å·¥ä½œæµ  
âœ… **è®¢å•çŠ¶æ€**ç”±å·¥ä½œæµç®¡ç†  
âœ… **æ”¯æŒå¤æ‚æ¡ä»¶**å’ŒåŠ¨ä½œ  
âœ… **å®Œæ•´çš„å†å²è®°å½•**è¿½è¸ª  
âœ… **å¯è§†åŒ–è®¾è®¡**å·¥ä½œæµå®šä¹‰  

ç”¨æˆ·ç°åœ¨å¯ä»¥ï¼š
1. åœ¨å·¥ä½œæµè®¾è®¡å™¨ä¸­åˆ›å»ºå’Œç¼–è¾‘å·¥ä½œæµå®šä¹‰
2. å·¥ä½œæµå®šä¹‰ä¼šè‡ªåŠ¨åº”ç”¨åˆ°æ–°åˆ›å»ºçš„è®¢å•
3. ä½¿ç”¨APIæ‰§è¡Œè®¢å•çŠ¶æ€è½¬æ¢
4. æŸ¥è¯¢å·¥ä½œæµçŠ¶æ€å’Œå†å²è®°å½•

**æ—§ç³»ç»Ÿ**ï¼ˆ`core/workflow/order_workflow_advanced.go`ï¼‰å¯ä»¥ä¿ç•™ç”¨äºå‘åå…¼å®¹ï¼Œæˆ–è€…é€æ­¥è¿ç§»åˆ°æ–°ç³»ç»Ÿã€‚

---

**å®æ–½çŠ¶æ€**: âœ… å®Œæˆ  
**å¯ç”¨æ€§**: âœ… ç«‹å³å¯ç”¨  
**æ–‡æ¡£å®Œæ•´åº¦**: âœ… 100%

