# Menu.roles å­—æ®µä½¿ç”¨è¯´æ˜

## âš ï¸ é‡è¦è¯´æ˜

`Menu.roles` å­—æ®µå®¹æ˜“ä¸è§’è‰²åˆ†é…èœå•ï¼ˆ`Role.menus`ï¼‰æ··æ·†ï¼Œä½¿ç”¨å‰è¯·æ˜ç¡®ç†è§£ã€‚

## ä¸¤ç§æƒé™æ§åˆ¶çš„åŒºåˆ«

### 1. Role.menusï¼ˆè§’è‰²æ‹¥æœ‰çš„èœå•ï¼‰- **ä¸»è¦æ–¹å¼**
```yaml
å«ä¹‰: è¿™ä¸ªè§’è‰²å¯ä»¥è®¿é—®å“ªäº›èœå•
é…ç½®ä½ç½®: è§’è‰²ç®¡ç† â†’ åˆ†é…æƒé™èœå•
ä½¿ç”¨è€…: æƒé™ç®¡ç†å‘˜
```

**ç¤ºä¾‹ï¼š**
```json
{
  "code": "manager",
  "name": "éƒ¨é—¨ç»ç†",
  "menus": ["dashboard", "admin", "role"]
}
```
- å«ä¹‰ï¼šmanager è§’è‰²çš„ç”¨æˆ·å¯ä»¥è®¿é—® dashboardã€adminã€role ä¸‰ä¸ªèœå•

### 2. Menu.rolesï¼ˆèœå•å…è®¸çš„è§’è‰²æ ‡è¯†ï¼‰- **ç³»ç»Ÿçº§é™åˆ¶**
```yaml
å«ä¹‰: è®¿é—®è¿™ä¸ªèœå•éœ€è¦å…·å¤‡å“ªäº›è§’è‰²æ ‡è¯†
é…ç½®ä½ç½®: ç³»ç»Ÿåˆå§‹åŒ– / è¶…çº§ç®¡ç†å‘˜
ä½¿ç”¨è€…: ç³»ç»Ÿç®¡ç†å‘˜
```

**ç¤ºä¾‹ï¼š**
```json
{
  "name": "tenant",
  "title": "ç§Ÿæˆ·ç®¡ç†",
  "roles": ["super"]  // åªæœ‰å…·æœ‰ 'super' æ ‡è¯†çš„ç”¨æˆ·èƒ½è®¿é—®
}
```

## é—®é¢˜åœºæ™¯

### âŒ é”™è¯¯ç†è§£
```
ç®¡ç†å‘˜A: åœ¨è§’è‰²ç®¡ç†ä¸­ï¼Œç»™ manager è§’è‰²åˆ†é…äº† tenant èœå•
ç®¡ç†å‘˜B: åœ¨èœå•ç®¡ç†ä¸­ï¼Œè®¾ç½® tenant.roles = ['super']

ç»“æœ: manager è§’è‰²è¢«åˆ†é…äº† tenantï¼Œä½†ç”¨æˆ·è®¿é—®æ—¶è¢«æ‹’ç»
åŸå› : ç”¨æˆ·çš„è§’è‰²æ ‡è¯†ä¸­æ²¡æœ‰ 'super'
```

**è¿™ä¼šé€ æˆå›°æƒ‘ï¼šä¸ºä»€ä¹ˆåˆ†é…äº†èœå•å´ä¸èƒ½è®¿é—®ï¼Ÿ**

## æ­£ç¡®ä½¿ç”¨æ–¹å¼

### æ–¹æ¡ˆAï¼šä¸ä½¿ç”¨ Menu.rolesï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹ï¼š**
- ç®€å•ç›´è§‚ï¼Œæ˜“äºç†è§£
- æƒé™ç®¡ç†å‘˜åªéœ€å…³æ³¨è§’è‰²åˆ†é…
- é¿å…æ··æ·†

**å®ç°ï¼š**
```json
// æ‰€æœ‰èœå•çš„ roles å­—æ®µä¸ºç©º
{
  "name": "admin",
  "title": "ç®¡ç†å‘˜ç®¡ç†",
  "roles": []  // ç©º = ä¸é™åˆ¶è§’è‰²æ ‡è¯†
}

// æƒé™å®Œå…¨ç”± Role.menus æ§åˆ¶
Role(manager): menus = ['dashboard', 'admin']
Role(viewer): menus = ['dashboard']
```

**ç•Œé¢è®¾è®¡ï¼š**
- èœå•ç®¡ç†ç•Œé¢ï¼š**ä¸æ˜¾ç¤º** roles å­—æ®µ
- è§’è‰²ç®¡ç†ç•Œé¢ï¼šåˆ†é…èœå•åˆ—è¡¨ï¼ˆå·²å®ç°ï¼‰

### æ–¹æ¡ˆBï¼šMenu.roles ä½œä¸ºç³»ç»Ÿä¿æŠ¤ï¼ˆé«˜çº§ï¼‰

**é€‚ç”¨åœºæ™¯ï¼š**
- éœ€è¦å¤šå±‚å®‰å…¨æ§åˆ¶
- ä¿æŠ¤è¶…çº§æ•æ„ŸåŠŸèƒ½
- é˜²æ­¢æƒé™ç®¡ç†å‘˜è¯¯åˆ†é…

**å®ç°ï¼š**
```json
// ç³»ç»Ÿåˆå§‹åŒ–æ—¶è®¾ç½®ï¼Œä¸å¯é€šè¿‡æ™®é€šç•Œé¢ä¿®æ”¹
{
  "name": "tenant",
  "title": "ç§Ÿæˆ·ç®¡ç†", 
  "roles": ["super"]  // ç¡¬é™åˆ¶
}

{
  "name": "system_config",
  "title": "ç³»ç»Ÿé…ç½®",
  "roles": ["super"]  // ç¡¬é™åˆ¶
}

// å…¶ä»–èœå•ä¿æŒç©º
{
  "name": "dashboard",
  "roles": []  // ä»»ä½•è§’è‰²éƒ½å¯ä»¥ï¼Œåªè¦è¢«åˆ†é…
}
```

**æƒé™æ£€æŸ¥æµç¨‹ï¼š**
```typescript
function canAccessMenu(user, menu) {
  // 1. ç”¨æˆ·è§’è‰²æ˜¯å¦è¢«åˆ†é…äº†è¿™ä¸ªèœå•
  const hasMenuInRole = user.roles.some(role => 
    role.menus.includes(menu.name)
  )
  if (!hasMenuInRole) return false
  
  // 2. å¦‚æœèœå•è®¾ç½®äº† rolesï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰å¯¹åº”çš„è§’è‰²æ ‡è¯†
  if (menu.roles && menu.roles.length > 0) {
    const hasRequiredRole = menu.roles.some(roleCode =>
      user.roleIdentifiers.includes(roleCode)
    )
    if (!hasRequiredRole) return false
  }
  
  return true
}
```

**æ•°æ®ç»“æ„ï¼š**
```typescript
// ç”¨æˆ·æ•°æ®
{
  "user_id": "xxx",
  "roles": [
    {
      "id": "role_id_1",
      "code": "manager",    // è§’è‰²æ ‡è¯†
      "menus": ["dashboard", "admin", "tenant"]
    }
  ],
  "roleIdentifiers": ["manager"]  // æ‰€æœ‰è§’è‰²çš„ code é›†åˆ
}

// èœå•æ•°æ®
{
  "name": "tenant",
  "roles": ["super"]  // éœ€è¦ super æ ‡è¯†
}

// æ£€æŸ¥
user.roles åŒ…å« tenant âœ…
ä½† user.roleIdentifiers ä¸åŒ…å« 'super' âŒ
â†’ ä¸èƒ½è®¿é—®
```

### æ–¹æ¡ˆCï¼šè§’è‰²æ ‡è¯†ä¸è§’è‰²åˆ†ç¦»ï¼ˆæœ€çµæ´»ï¼‰

**è®¾è®¡æ€è·¯ï¼š**
- è§’è‰²ï¼ˆRoleï¼‰ï¼šç”¨äºåˆ†é…èœå•æƒé™
- æ ‡ç­¾ï¼ˆTag/Labelï¼‰ï¼šç”¨äºç»†ç²’åº¦è®¿é—®æ§åˆ¶

**å®ç°ï¼š**
```typescript
// Admin æ¨¡å‹
{
  "roles": ["role_id_1", "role_id_2"],  // è§’è‰²IDï¼ˆå†³å®šèœå•ï¼‰
  "tags": ["super", "auditor"]           // æ ‡ç­¾ï¼ˆå†³å®šç»†ç²’åº¦æƒé™ï¼‰
}

// Menu æ¨¡å‹  
{
  "name": "tenant",
  "required_tags": ["super"]  // éœ€è¦çš„æ ‡ç­¾
}

// æ£€æŸ¥
hasMenu = user.roles çš„ menus åŒ…å« tenant
hasTags = user.tags åŒ…å« "super"
canAccess = hasMenu && hasTags
```

## æ¨èå®æ–½

### é˜¶æ®µ1ï¼šç®€åŒ–æ¨¡å¼ï¼ˆç«‹å³å¯ç”¨ï¼‰
1. **ä¸ä½¿ç”¨ Menu.roles**
2. èœå•ç®¡ç†ç•Œé¢ä¸æ˜¾ç¤º roles å­—æ®µ
3. å®Œå…¨åŸºäºè§’è‰²åˆ†é…èœå•æ§åˆ¶
4. æ¸…æ™°ã€ç®€å•ã€æ˜“ç»´æŠ¤ âœ…

### é˜¶æ®µ2ï¼šé«˜çº§æ¨¡å¼ï¼ˆå¯é€‰ï¼‰
1. **ä¿ç•™ Menu.roles** ä½œä¸ºç³»ç»Ÿçº§ä¿æŠ¤
2. é€šè¿‡ä»£ç æˆ–æ•°æ®åº“è„šæœ¬åˆå§‹åŒ–æ•æ„Ÿèœå•çš„ roles
3. æ™®é€šç®¡ç†å‘˜ä¸å¯ä¿®æ”¹
4. ä»…è¶…çº§ç®¡ç†å‘˜é€šè¿‡ç‰¹æ®Šç•Œé¢ä¿®æ”¹

### é˜¶æ®µ3ï¼šæ ‡ç­¾ç³»ç»Ÿï¼ˆé•¿æœŸï¼‰
1. å¼•å…¥ç‹¬ç«‹çš„æ ‡ç­¾ç³»ç»Ÿ
2. è§’è‰²ç”¨äºåˆ†é…èœå•ï¼ˆç²—ç²’åº¦ï¼‰
3. æ ‡ç­¾ç”¨äºç»†ç²’åº¦æ§åˆ¶ï¼ˆMenu.roles æ”¹ä¸º Menu.required_tagsï¼‰
4. æ›´çµæ´»ã€æ›´æ¸…æ™°

## ç»“è®º

**å¯¹äºå½“å‰ç³»ç»Ÿï¼Œå»ºè®®ï¼š**
- âœ… **ä¸åœ¨èœå•ç®¡ç†ç•Œé¢æ˜¾ç¤º roles å­—æ®µ**
- âœ… **ä¿ç•™å­—æ®µä½†ä¸é€šè¿‡ç•Œé¢é…ç½®**
- âœ… **å®Œå…¨é€šè¿‡è§’è‰²åˆ†é…èœå•æ§åˆ¶æƒé™**
- âœ… **Menu.roles ç•™ç©ºæˆ–ç”±ç³»ç»Ÿåˆå§‹åŒ–**

**å¦‚æœéœ€è¦ç»†ç²’åº¦æ§åˆ¶ï¼š**
- ğŸ”„ è€ƒè™‘å¼•å…¥æ ‡ç­¾ç³»ç»Ÿ
- ğŸ”„ æˆ–è€…å°† Menu.roles æ”¹åä¸º Menu.access_tags
- ğŸ”„ é¿å…ä¸è§’è‰²åˆ†é…èœå•æ··æ·†

