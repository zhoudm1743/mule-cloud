# 清理孤立裁片监控记录

## 问题说明
当批次被删除时，如果没有同步删除对应的裁片监控记录，会导致裁片监控列表中显示已删除批次的记录。

## 已修复
从现在开始，删除批次时会自动删除对应的裁片监控记录。

## 清理已有的孤立数据

### 方法1：使用MongoDB命令（推荐）

```bash
# 1. 连接到MongoDB
docker exec -it mule-cloud-mongodb mongosh -u root -p bgg8384495 --authenticationDatabase admin

# 2. 切换到租户数据库（例如 mule_ace）
use mule_ace

# 3. 查看孤立记录（合同号为 202510183528 的）
db.cutting_pieces.find({contract_no: "202510183528"})

# 4. 删除孤立记录
db.cutting_pieces.deleteMany({contract_no: "202510183528"})
```

### 方法2：按床号和扎号删除

如果你知道具体的床号和扎号：

```bash
# 删除床号02的所有裁片监控记录
db.cutting_pieces.deleteMany({bed_no: "02"})

# 或者删除特定床号和扎号的记录
db.cutting_pieces.deleteMany({
    bed_no: "02",
    bundle_no: "7"
})
```

### 方法3：使用清理脚本

```bash
# 1. 连接到MongoDB
docker exec -it mule-cloud-mongodb mongosh -u root -p bgg8384495 --authenticationDatabase admin

# 2. 切换到租户数据库
use mule_ace

# 3. 运行清理脚本（自动查找并删除所有孤立记录）
load('/path/to/scripts/clean_orphan_pieces.js')
```

### 方法4：通过Docker直接执行

最快的方法，一键清理合同号 202510183528 的所有孤立记录：

```bash
docker exec -it mule-cloud-mongodb mongosh -u root -p bgg8384495 --authenticationDatabase admin --eval "use mule_ace; db.cutting_pieces.deleteMany({contract_no: '202510183528'})"
```

## 验证清理结果

清理后，刷新前端页面，裁片监控列表应该不再显示已删除批次的记录。

## 预防措施

1. 已修改代码，删除批次时自动删除裁片监控记录
2. 重新编译并部署order服务后，此问题不会再出现

