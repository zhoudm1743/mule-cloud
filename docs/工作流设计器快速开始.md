# 工作流设计器快速开始 🚀

## ⚡ 5分钟上手

### 1️⃣ 启动服务

```bash
# 启动后端（工作流API已自动集成到order服务）
./start.ps1
```

### 2️⃣ 配置菜单

在后台管理系统 → 菜单管理 中添加：

**工作流定义列表**
```json
{
  "title": "工作流定义",
  "path": "/order/workflow/designer/list",
  "component": "views/order/workflow/designer/list.vue",
  "icon": "carbon:flow-data",
  "parent_id": "工作流管理的父级菜单ID"
}
```

**工作流设计器**（隐藏，通过列表进入）
```json
{
  "title": "工作流设计器",
  "path": "/order/workflow/designer",
  "component": "views/order/workflow/designer/index.vue",
  "icon": "carbon:flow-stream",
  "hidden": true
}
```

### 3️⃣ 开始使用

1. **访问工作流列表页**
   ```
   http://localhost:3000/#/order/workflow/designer/list
   ```

2. **创建第一个工作流**
   - 点击"新建工作流"
   - 或点击"模板库"选择模板

3. **设计工作流**
   - 从左侧拖拽节点到画布
   - 连接节点创建转换
   - 配置节点和转换属性

4. **保存并发布**
   - 点击"保存"按钮
   - 点击"发布"按钮激活

## 🎯 核心功能

### 📊 可视化设计器

```
┌────────┬──────────────────────────┬────────────┐
│组件面板│        LogicFlow画布      │  属性配置   │
├────────┼──────────────────────────┼────────────┤
│        │                          │            │
│ 开始   │    ┌──────┐              │ 节点名称   │
│ 普通   │    │ 草稿 │              │ 节点类型   │
│ 结束   │    └──┬───┘              │ 节点颜色   │
│        │       │ 提交              │ 描述信息   │
│        │    ┌──▼───┐              │            │
│        │    │已下单│              │ [更新]     │
│        │    └──────┘              │ [删除]     │
│        │                          │            │
└────────┴──────────────────────────┴────────────┘
```

### 🔧 基本操作

#### 添加节点
1. 在左侧选择节点类型
2. 拖拽到画布
3. 双击或点击右侧配置

#### 创建连线
1. 从一个节点拖拽到另一个节点
2. 点击连线
3. 在右侧配置转换规则

#### 配置条件
1. 选中连线
2. 点击"添加条件"
3. 设置：字段名、操作符、比较值

## 💡 使用示例

### 示例1：简单订单流程

```
草稿 → 已下单 → 生产中 → 已完成
```

**操作步骤**：
1. 拖拽4个节点：1个开始 + 2个普通 + 1个结束
2. 连接节点
3. 配置节点名称
4. 保存

### 示例2：带审批的订单流程

```
草稿 → 待审批 → 已下单 → 生产中 → 已完成
         ↓
       已拒绝
```

**操作步骤**：
1. 创建5个状态节点
2. 从"待审批"连接到"已下单"和"已拒绝"
3. 配置"审批通过"和"审批拒绝"事件
4. 设置权限要求（如需要审批员角色）

### 示例3：带条件的质检流程

```
待检 → 质检中 → [条件判断]
              ↓ 合格 → 入库
              ↓ 不合格 → 返工 → 质检中
```

**转换条件配置**：
```json
{
  "field": "quality_score",
  "operator": "gte",
  "value": 90,
  "description": "质检分数≥90分"
}
```

## 📋 预定义模板

### 1. 基础订单流程
适用于简单订单处理
```
草稿 → 已下单 → 生产中 → 已完成
```

### 2. 订单审批流程
包含审批环节
```
草稿 → 待审批 → 已下单 → 生产中 → 已完成
```

### 3. 质检流程
生产质量检查
```
待检 → 质检中 → 合格/不合格 → 返工/入库
```

### 4. 简单审批流程
一级审批
```
提交 → 审批 → 完成/驳回
```

### 5. 多级审批流程
多级审批
```
提交 → 初审 → 复审 → 终审 → 完成
```

## 🎨 节点类型

### 开始节点（绿色圆角）
- 工作流起点
- 每个工作流只能有一个
- 用于定义初始状态

### 普通节点（蓝色方形）
- 中间状态
- 可以有多个
- 代表业务流程中的各个阶段

### 结束节点（红色圆角）
- 工作流终点
- 可以有多个（如：已完成、已取消）
- 代表最终状态

## ⚙️ 配置选项

### 节点配置
- **名称**: 状态名称（如：草稿、已下单）
- **类型**: 开始/普通/结束
- **颜色**: 节点显示颜色
- **描述**: 状态说明

### 转换配置
- **事件**: 触发事件名称（如：submit、approve）
- **权限**: 需要的角色（可选）
- **条件**: 转换条件列表
  - 字段名
  - 操作符（=, >, >=, <, <=）
  - 比较值
- **描述**: 转换说明

## 🔑 条件操作符

| 操作符 | 说明 | 示例 |
|-------|------|------|
| eq    | 等于 | progress == 1.0 |
| gt    | 大于 | amount > 1000 |
| gte   | 大于等于 | score >= 90 |
| lt    | 小于 | days < 7 |
| lte   | 小于等于 | priority <= 3 |

## 🚦 工作流状态

### 草稿
- 工作流未激活
- 可以编辑修改

### 激活
- 工作流已发布
- 可用于创建实例
- 同一编码只能有一个激活版本

### 停用
- 暂时停用
- 不影响已有实例
- 可重新激活

## 📊 版本管理

### 自动版本
- 每次保存自动增加版本号
- v1 → v2 → v3 ...

### 版本切换
- 激活新版本会停用旧版本
- 已有实例继续使用原版本

### 版本历史
- 查看所有版本
- 对比版本差异（待实现）

## 🔐 权限控制

### 配置权限
在转换规则中设置`require_role`：
```json
{
  "require_role": "admin"
}
```

### 权限检查
系统在执行转换时自动检查用户角色

## 🎯 最佳实践

### 1. 命名规范
- **工作流编码**: 使用小写字母+下划线（如：order_workflow）
- **状态名称**: 简洁明了（如：草稿、已下单）
- **事件名称**: 动词形式（如：submit、approve、cancel）

### 2. 设计原则
- 每个工作流只有一个开始节点
- 至少有一个结束节点
- 避免循环引用（除非必要）
- 合理使用条件判断

### 3. 性能优化
- 避免过多的条件检查
- 合理设计状态数量
- 及时停用不用的工作流

## 🐛 常见问题

### Q1: 无法保存工作流？
**A**: 检查是否填写了工作流名称和编码。

### Q2: 激活失败？
**A**: 确保至少有一个开始节点和一个结束节点。

### Q3: 条件不生效？
**A**: 检查字段名是否正确，确保元数据中包含该字段。

### Q4: 如何复制工作流？
**A**: 在列表页点击"复制"按钮，会创建一个新的工作流。

### Q5: 如何删除节点？
**A**: 选中节点后，在右侧配置面板点击"删除"按钮。

## 📚 API使用

### 查询工作流列表
```typescript
import { fetchWorkflowDefinitions } from '@/service/api/workflow-designer'

const { data } = await fetchWorkflowDefinitions({
  page: 1,
  page_size: 10
})
```

### 创建工作流
```typescript
import { createWorkflowDefinition } from '@/service/api/workflow-designer'

await createWorkflowDefinition({
  name: "订单工作流",
  code: "order_workflow",
  description: "订单处理流程",
  states: [...],
  transitions: [...]
})
```

### 激活工作流
```typescript
import { activateWorkflowDefinition } from '@/service/api/workflow-designer'

await activateWorkflowDefinition(workflowId)
```

## 🎓 进阶功能

### 脚本条件（待实现）
支持JavaScript表达式：
```javascript
{
  type: "script",
  script: "order.amount > 1000 && order.priority === 'high'"
}
```

### 自定义动作（待实现）
支持webhook、通知等：
```javascript
{
  type: "send_notification",
  target: "admin",
  message: "订单已提交"
}
```

### 工作流模拟（待实现）
在发布前模拟执行流程

## 🔗 相关文档

- [工作流设计器完整实施总结.md](./工作流设计器完整实施总结.md) - 完整功能说明
- [工作流设计器功能说明.md](./工作流设计器功能说明.md) - 功能详解
- [工作流高级功能说明.md](./工作流高级功能说明.md) - 高级特性

## 🎉 开始创建你的第一个工作流吧！

1. 访问 `/order/workflow/designer/list`
2. 点击"新建工作流"或"模板库"
3. 拖拽节点，连接转换
4. 保存并发布

祝使用愉快！🚀

