# é‚€è¯·ç ç³»ç»Ÿå®ç°æ–¹æ¡ˆ

## ğŸ“‹ å½“å‰çŠ¶æ€

**ä¸´æ—¶æ–¹æ¡ˆ**ï¼šé‚€è¯·ç  = ç§Ÿæˆ· code
- âœ… ä¼˜ç‚¹ï¼šç®€å•å¿«é€Ÿ
- âŒ ç¼ºç‚¹ï¼šä¸å®‰å…¨ï¼Œä»»ä½•äººçŸ¥é“ç§Ÿæˆ· code å°±èƒ½åŠ å…¥

## ğŸ¯ æ¨èæ–¹æ¡ˆï¼šç‹¬ç«‹é‚€è¯·ç ç³»ç»Ÿ

### æ•°æ®æ¨¡å‹

```go
// TenantInvite ç§Ÿæˆ·é‚€è¯·ç è¡¨ï¼ˆå­˜å‚¨åœ¨ç³»ç»Ÿåº“ï¼‰
type TenantInvite struct {
    ID         string `bson:"_id,omitempty"`
    Code       string `bson:"code"`          // 6ä½é‚€è¯·ç ï¼ˆéšæœºç”Ÿæˆï¼‰
    TenantID   string `bson:"tenant_id"`     // ç§Ÿæˆ·ID
    TenantCode string `bson:"tenant_code"`   // ç§Ÿæˆ·ä»£ç 
    
    // é‚€è¯·ç é…ç½®
    MaxUse     int    `bson:"max_use"`       // æœ€å¤§ä½¿ç”¨æ¬¡æ•°ï¼ˆ0=æ— é™åˆ¶ï¼‰
    UsedCount  int    `bson:"used_count"`    // å·²ä½¿ç”¨æ¬¡æ•°
    ExpiresAt  int64  `bson:"expires_at"`    // è¿‡æœŸæ—¶é—´ï¼ˆ0=æ°¸ä¹…æœ‰æ•ˆï¼‰
    
    // è§’è‰²é…ç½®
    DefaultRole string `bson:"default_role"` // é»˜è®¤è§’è‰²ï¼ˆå¦‚ï¼šemployeeï¼‰
    
    // çŠ¶æ€
    Status     string `bson:"status"`        // active/disabled
    
    // åˆ›å»ºä¿¡æ¯
    CreatedBy  string `bson:"created_by"`    // åˆ›å»ºäºº
    CreatedAt  int64  `bson:"created_at"`
    UpdatedAt  int64  `bson:"updated_at"`
}
```

### API æ¥å£

#### 1. ç”Ÿæˆé‚€è¯·ç ï¼ˆç®¡ç†å‘˜ï¼‰

```go
POST /admin/tenant/invite/generate
{
  "tenant_id": "ç§Ÿæˆ·ID",
  "max_use": 10,           // æœ€å¤šä½¿ç”¨10æ¬¡
  "expires_at": 1234567890, // è¿‡æœŸæ—¶é—´
  "default_role": "employee"
}

Response:
{
  "code": "ABC123",  // 6ä½é‚€è¯·ç 
  "expires_at": 1234567890,
  "max_use": 10
}
```

#### 2. éªŒè¯é‚€è¯·ç ï¼ˆå°ç¨‹åºï¼‰

```go
POST /miniapp/wechat/validate-invite
{
  "invite_code": "ABC123"
}

Response:
{
  "valid": true,
  "tenant_name": "ACEå·¥å‚",
  "tenant_id": "xxx",
  "expires_at": 1234567890,
  "remaining_uses": 5
}
```

#### 3. ä½¿ç”¨é‚€è¯·ç ç»‘å®š

```go
POST /miniapp/wechat/bind-tenant
{
  "user_id": "ç”¨æˆ·ID",
  "invite_code": "ABC123"
}
```

### é‚€è¯·ç ç”Ÿæˆè§„åˆ™

```go
// ç”Ÿæˆ6ä½éšæœºé‚€è¯·ç ï¼ˆæ•°å­—+å¤§å†™å­—æ¯ï¼Œæ’é™¤æ˜“æ··æ·†å­—ç¬¦ï¼‰
func GenerateInviteCode() string {
    chars := "23456789ABCDEFGHJKLMNPQRSTUVWXYZ" // æ’é™¤ 0O1I
    code := make([]byte, 6)
    for i := range code {
        code[i] = chars[rand.Intn(len(chars))]
    }
    return string(code)
}

// ç¤ºä¾‹ï¼šAB3K7M
```

### å‰ç«¯æ˜¾ç¤ºä¼˜åŒ–

```vue
<template>
  <view class="invite-input">
    <input 
      v-model="inviteCode" 
      placeholder="è¯·è¾“å…¥6ä½é‚€è¯·ç "
      maxlength="6"
      @input="handleInput"
    />
    <button @click="validateCode">éªŒè¯</button>
  </view>
  
  <!-- æ˜¾ç¤ºç§Ÿæˆ·ä¿¡æ¯ -->
  <view v-if="tenantInfo" class="tenant-preview">
    <text>âœ“ å°†åŠ å…¥ï¼š{{ tenantInfo.tenant_name }}</text>
    <text v-if="tenantInfo.expires_at">è¿‡æœŸæ—¶é—´ï¼š{{ formatDate(tenantInfo.expires_at) }}</text>
  </view>
</template>
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

1. **é™åˆ¶ä½¿ç”¨æ¬¡æ•°**ï¼šé˜²æ­¢é‚€è¯·ç è¢«æ»¥ç”¨
2. **è®¾ç½®æœ‰æ•ˆæœŸ**ï¼šè¿‡æœŸè‡ªåŠ¨å¤±æ•ˆ
3. **å¯éšæ—¶ç¦ç”¨**ï¼šç®¡ç†å‘˜å¯ä»¥ä½œåºŸé‚€è¯·ç 
4. **ä½¿ç”¨è®°å½•**ï¼šè®°å½•æ¯æ¬¡ä½¿ç”¨çš„ç”¨æˆ·å’Œæ—¶é—´
5. **é»˜è®¤è§’è‰²**ï¼šä¸åŒé‚€è¯·ç å¯ä»¥è®¾ç½®ä¸åŒçš„é»˜è®¤è§’è‰²

## ğŸ“Š ç®¡ç†åå°åŠŸèƒ½

### é‚€è¯·ç ç®¡ç†é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é‚€è¯·ç ç®¡ç†                    [+ ç”Ÿæˆæ–°é‚€è¯·ç ]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é‚€è¯·ç    çŠ¶æ€   å·²ç”¨/æ€»æ•°  è¿‡æœŸæ—¶é—´    æ“ä½œ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AB3K7M   æœ‰æ•ˆ    5/10    2025-12-31  ç¦ç”¨   â”‚
â”‚ XY8P2N   æœ‰æ•ˆ    0/âˆ     æ°¸ä¹…        ç¦ç”¨   â”‚
â”‚ QW4R9T   å·²æ»¡    20/20   2025-10-15  åˆ é™¤   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å®æ–½æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ•°æ®æ¨¡å‹å’Œ Repository

```bash
# åˆ›å»ºæ–‡ä»¶
touch internal/models/tenant_invite.go
touch internal/repository/tenant_invite.go
```

### ç¬¬äºŒæ­¥ï¼šå®ç°é‚€è¯·ç ç”Ÿæˆå’ŒéªŒè¯æœåŠ¡

```bash
# åœ¨ auth æˆ– perms æœåŠ¡ä¸­æ·»åŠ 
touch app/perms/services/invite.go
```

### ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ  API æ¥å£

```bash
# ç®¡ç†ç«¯ API
touch app/perms/endpoint/invite.go
touch app/perms/transport/invite.go
```

### ç¬¬å››æ­¥ï¼šä¿®æ”¹å°ç¨‹åºç»‘å®šé€»è¾‘

ä¿®æ”¹ `app/miniapp/services/wechat.go` ä¸­çš„ `BindTenant` å‡½æ•°ï¼Œä½¿ç”¨é‚€è¯·ç è¡¨éªŒè¯ã€‚

## ğŸ“ æ•°æ®åº“ç´¢å¼•

```javascript
// tenant_system åº“
db.tenant_invite.createIndex({ "code": 1 }, { unique: true })
db.tenant_invite.createIndex({ "tenant_id": 1 })
db.tenant_invite.createIndex({ "status": 1, "expires_at": 1 })
```

## ğŸ¯ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### å°ç¨‹åºç«¯

1. **è¾“å…¥å®æ—¶éªŒè¯**ï¼šè¾“å…¥6ä½è‡ªåŠ¨éªŒè¯
2. **æ˜¾ç¤ºç§Ÿæˆ·é¢„è§ˆ**ï¼šéªŒè¯æˆåŠŸåæ˜¾ç¤ºè¦åŠ å…¥çš„ä¼ä¸šä¿¡æ¯
3. **é”™è¯¯æç¤ºä¼˜åŒ–**ï¼š
   - "é‚€è¯·ç ä¸å­˜åœ¨"
   - "é‚€è¯·ç å·²è¿‡æœŸ"
   - "é‚€è¯·ç å·²è¾¾ä½¿ç”¨ä¸Šé™"
   - "é‚€è¯·ç å·²è¢«ç¦ç”¨"

### ç®¡ç†ç«¯

1. **æ‰¹é‡ç”Ÿæˆ**ï¼šä¸€æ¬¡ç”Ÿæˆå¤šä¸ªé‚€è¯·ç 
2. **äºŒç»´ç åˆ†äº«**ï¼šç”ŸæˆåŒ…å«é‚€è¯·ç çš„äºŒç»´ç 
3. **ä½¿ç”¨ç»Ÿè®¡**ï¼šæŸ¥çœ‹æ¯ä¸ªé‚€è¯·ç çš„ä½¿ç”¨æƒ…å†µ

## ğŸ’¡ é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

1. **éƒ¨é—¨é‚€è¯·ç **ï¼šä¸åŒéƒ¨é—¨ä½¿ç”¨ä¸åŒé‚€è¯·ç ï¼Œè‡ªåŠ¨åˆ†é…éƒ¨é—¨
2. **èŒä½é‚€è¯·ç **ï¼šæ™®é€šå‘˜å·¥å’Œç®¡ç†å‘˜ä½¿ç”¨ä¸åŒé‚€è¯·ç 
3. **ä¸´æ—¶é‚€è¯·ç **ï¼šä¸€æ¬¡æ€§é‚€è¯·ç ï¼Œä½¿ç”¨åç«‹å³å¤±æ•ˆ
4. **é‚€è¯·é“¾æ¥**ï¼šç”Ÿæˆå¸¦é‚€è¯·ç çš„å°ç¨‹åºé“¾æ¥ï¼Œä¸€é”®åŠ å…¥

---

**å½“å‰çŠ¶æ€**ï¼šä¸´æ—¶æ–¹æ¡ˆï¼ˆé‚€è¯·ç  = ç§Ÿæˆ· codeï¼‰  
**æ¨èå‡çº§**ï¼šå®ç°ç‹¬ç«‹é‚€è¯·ç ç³»ç»Ÿ  
**é¢„è®¡å·¥ä½œé‡**ï¼š1-2å¤©

