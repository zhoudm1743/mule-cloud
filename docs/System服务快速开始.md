# System æœåŠ¡å¿«é€Ÿå¼€å§‹

## ğŸ¯ æ¦‚è¿°

System æœåŠ¡æ˜¯ Mule-Cloud çš„ç³»ç»Ÿç®¡ç†å¾®æœåŠ¡ï¼Œæä¾›æ“ä½œæ—¥å¿—ç®¡ç†ã€ç³»ç»Ÿç›‘æ§ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ“¦ å·²å®ç°åŠŸèƒ½

### âœ… æ“ä½œæ—¥å¿—ç®¡ç†

- **æ“ä½œæ—¥å¿—åˆ—è¡¨**ï¼šæ”¯æŒå¤šæ¡ä»¶ç­›é€‰ã€åˆ†é¡µæŸ¥è¯¢
- **æ“ä½œæ—¥å¿—è¯¦æƒ…**ï¼šæŸ¥çœ‹å®Œæ•´çš„è¯·æ±‚å“åº”ä¿¡æ¯
- **æ“ä½œæ—¥å¿—ç»Ÿè®¡**ï¼šTOPç”¨æˆ·ã€TOPæ“ä½œã€æˆåŠŸç‡ç­‰ç»Ÿè®¡

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```powershell
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…æ‹¬ systemï¼‰
./start.ps1

# åœ¨è¿è¡Œçš„è„šæœ¬ä¸­ç®¡ç† system æœåŠ¡
start system      # å¯åŠ¨
restart system    # é‡å¯
stop system       # åœæ­¢
status           # æŸ¥çœ‹çŠ¶æ€
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# 1. ç¼–è¯‘æœåŠ¡
go build -o bin/system.exe cmd/system/main.go

# 2. è¿è¡ŒæœåŠ¡
./bin/system.exe

# 3. ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
./bin/system.exe -config config/system.yaml
```

## ğŸ“¡ æœåŠ¡ä¿¡æ¯

- **æœåŠ¡åç§°**ï¼š`systemservice`
- **ç«¯å£**ï¼š`8089`
- **å¥åº·æ£€æŸ¥**ï¼š`http://localhost:8089/health`
- **Consulæ³¨å†Œ**ï¼šè‡ªåŠ¨æ³¨å†Œåˆ° Consul
- **ç½‘å…³è·¯ç”±**ï¼š`/admin/system/*`

## ğŸŒ API ç«¯ç‚¹

### æ“ä½œæ—¥å¿—

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/admin/system/operation-logs` | è·å–æ“ä½œæ—¥å¿—åˆ—è¡¨ |
| GET | `/admin/system/operation-logs/:id` | è·å–æ“ä½œæ—¥å¿—è¯¦æƒ… |
| GET | `/admin/system/operation-logs/stats` | è·å–æ“ä½œæ—¥å¿—ç»Ÿè®¡ |

### ç¤ºä¾‹è¯·æ±‚

```bash
# 1. è·å–æ“ä½œæ—¥å¿—åˆ—è¡¨
curl -X GET "http://localhost:8080/admin/system/operation-logs?page=1&page_size=10" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 2. æŒ‰ç”¨æˆ·åç­›é€‰
curl -X GET "http://localhost:8080/admin/system/operation-logs?page=1&page_size=10&username=å¼ ä¸‰" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 3. æŒ‰æ—¶é—´èŒƒå›´ç­›é€‰
curl -X GET "http://localhost:8080/admin/system/operation-logs?page=1&page_size=10&start_time=1704067200&end_time=1704153600" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 4. è·å–ç»Ÿè®¡æ•°æ®
curl -X GET "http://localhost:8080/admin/system/operation-logs/stats?start_time=1704067200&end_time=1704153600" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## ğŸ¨ å‰ç«¯é¡µé¢

### è®¿é—®åœ°å€

å‰ç«¯é¡µé¢é€šè¿‡ Nova-admin è®¿é—®ï¼Œéœ€è¦é…ç½®è·¯ç”±ã€‚

**æ¨èè·¯ç”±é…ç½®ï¼š**

```typescript
// åœ¨èœå•é…ç½®ä¸­æ·»åŠ 
{
  name: 'system',
  path: '/system',
  component: 'layout.base',
  meta: {
    title: 'ç³»ç»Ÿç®¡ç†',
    icon: 'carbon:settings',
    order: 90,
  },
  children: [
    {
      name: 'system_operation-log',
      path: '/system/operation-log',
      component: 'view.system_operation-log',
      meta: {
        title: 'æ“ä½œæ—¥å¿—',
        icon: 'carbon:document',
        requiresAuth: true,
      },
    },
    {
      name: 'system_operation-log-stats',
      path: '/system/operation-log/stats',
      component: 'view.system_operation-log-stats',
      meta: {
        title: 'æ—¥å¿—ç»Ÿè®¡',
        icon: 'carbon:analytics',
        requiresAuth: true,
      },
    },
  ],
}
```

### é¡µé¢åŠŸèƒ½

#### 1. æ“ä½œæ—¥å¿—åˆ—è¡¨é¡µ

**è·¯å¾„**ï¼š`/system/operation-log`

**åŠŸèƒ½**ï¼š
- âœ… å¤šæ¡ä»¶ç­›é€‰ï¼ˆç”¨æˆ·åã€èµ„æºã€æ–¹æ³•ã€æ“ä½œç±»å‹ã€æ—¶é—´èŒƒå›´ï¼‰
- âœ… åˆ†é¡µå±•ç¤º
- âœ… æŸ¥çœ‹è¯¦æƒ…
- âœ… å®æ—¶åˆ·æ–°

**æˆªå›¾ç¤ºæ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œæ—¥å¿—                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·å [____] èµ„æº [____] æ–¹æ³• [â–¼] æ—¶é—´ [____]  â”‚
â”‚ [æœç´¢] [é‡ç½®]                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ—¶é—´ | ç”¨æˆ· | æ–¹æ³• | è·¯å¾„ | èµ„æº | æ“ä½œ | çŠ¶æ€... â”‚
â”‚ 2024-01-01 10:00 | å¼ ä¸‰ | POST | /admin/... ... â”‚
â”‚ 2024-01-01 09:55 | æå›› | GET  | /admin/... ... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. æ“ä½œæ—¥å¿—ç»Ÿè®¡é¡µ

**è·¯å¾„**ï¼š`/system/operation-log/stats`

**åŠŸèƒ½**ï¼š
- âœ… æ€»è§ˆç»Ÿè®¡ï¼ˆæ€»æ“ä½œæ•°ã€æˆåŠŸç‡ã€å¤±è´¥ç‡ã€å¹³å‡è€—æ—¶ï¼‰
- âœ… TOP 10 æ“ä½œç”¨æˆ·
- âœ… TOP 10 æ“ä½œç±»å‹
- âœ… è‡ªå®šä¹‰æ—¶é—´èŒƒå›´

**ç»Ÿè®¡æŒ‡æ ‡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ€»æ“ä½œæ•°: 1,000      â”‚ æˆåŠŸæ“ä½œ: 950 (95%) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤±è´¥æ“ä½œ: 50 (5%)    â”‚ å¹³å‡è€—æ—¶: 123ms     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOP 10 æ“ä½œç”¨æˆ·:
1. ğŸ¥‡ å¼ ä¸‰ - 150æ¬¡
2. ğŸ¥ˆ æå›› - 120æ¬¡
3. ğŸ¥‰ ç‹äº” - 100æ¬¡

TOP 10 æ“ä½œç±»å‹:
1. ğŸ¥‡ create - 300æ¬¡
2. ğŸ¥ˆ update - 250æ¬¡
3. ğŸ¥‰ delete - 150æ¬¡
```

## ğŸ”§ é…ç½®è¯´æ˜

### ä¿®æ”¹ç«¯å£

ç¼–è¾‘ `config/system.yaml`ï¼š

```yaml
server:
  port: 8089  # ä¿®æ”¹ä¸ºå…¶ä»–ç«¯å£

consul:
  service_port: 8089  # åŒæ­¥ä¿®æ”¹
```

### ç¦ç”¨ Consul

```yaml
consul:
  enabled: false  # ç¦ç”¨ Consul æ³¨å†Œ
```

### ä¿®æ”¹æ•°æ®åº“

```yaml
mongodb:
  host: "127.0.0.1"
  port: 27015
  database: "mule"  # ç³»ç»Ÿæ•°æ®åº“
```

## ğŸ“Š æ•°æ®å­˜å‚¨

### æ“ä½œæ—¥å¿—å­˜å‚¨ç­–ç•¥

æ“ä½œæ—¥å¿—é‡‡ç”¨**ç§Ÿæˆ·éš”ç¦»**å­˜å‚¨ï¼š

1. **ç³»ç»Ÿç®¡ç†å‘˜æ“ä½œ**ï¼šå­˜å‚¨åœ¨ `system` æ•°æ®åº“
2. **ç§Ÿæˆ·ç”¨æˆ·æ“ä½œ**ï¼šå­˜å‚¨åœ¨å¯¹åº”ç§Ÿæˆ·æ•°æ®åº“

**å­˜å‚¨è·¯å¾„**ï¼š
```
MongoDB
â”œâ”€â”€ system (ç³»ç»Ÿåº“)
â”‚   â””â”€â”€ operation_logs (ç³»ç»Ÿç®¡ç†å‘˜çš„æ—¥å¿—)
â”œâ”€â”€ ace (ç§Ÿæˆ·ace)
â”‚   â””â”€â”€ operation_logs (ç§Ÿæˆ·aceçš„æ—¥å¿—)
â””â”€â”€ test (ç§Ÿæˆ·test)
    â””â”€â”€ operation_logs (ç§Ÿæˆ·testçš„æ—¥å¿—)
```

### è‡ªåŠ¨æ¸…ç†

å»ºè®®é…ç½® TTL ç´¢å¼•è‡ªåŠ¨æ¸…ç†æ—§æ—¥å¿—ï¼š

```javascript
// MongoDB Shell
use system
db.operation_logs.createIndex(
  { "created_at": 1 },
  { expireAfterSeconds: 7776000 }  // 90å¤©åè‡ªåŠ¨åˆ é™¤
)
```

## ğŸ” æ•…éšœæ’æŸ¥

### 1. æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr ":8089"

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
./bin/system.exe 2>&1 | tee system.log
```

### 2. æ— æ³•æŸ¥è¯¢æ—¥å¿—

**å¯èƒ½åŸå› **ï¼š
- æƒé™ä¸è¶³ï¼ˆéœ€è¦ç™»å½•ï¼‰
- ç§Ÿæˆ·ä¸Šä¸‹æ–‡é”™è¯¯
- æ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥ JWT Token
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:8080/auth/profile

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mongosh --host 127.0.0.1 --port 27015
```

### 3. ç»Ÿè®¡æ•°æ®ä¸å‡†ç¡®

**å¯èƒ½åŸå› **ï¼š
- æ—¶é—´èŒƒå›´è®¾ç½®é”™è¯¯
- ç´¢å¼•æœªåˆ›å»º

**è§£å†³æ–¹æ³•**ï¼š
```javascript
// åˆ›å»ºç´¢å¼•
db.operation_logs.createIndex({ "user_id": 1 })
db.operation_logs.createIndex({ "created_at": -1 })
db.operation_logs.createIndex({ "user_id": 1, "created_at": -1 })
```

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„ç³»ç»ŸåŠŸèƒ½

1. **åˆ›å»º DTO**ï¼š`app/system/dto/your_feature.go`
2. **åˆ›å»º Service**ï¼š`app/system/services/your_feature.go`
3. **åˆ›å»º Endpoint**ï¼š`app/system/endpoint/your_feature.go`
4. **åˆ›å»º Transport**ï¼š`app/system/transport/your_feature.go`
5. **æ³¨å†Œè·¯ç”±**ï¼šåœ¨ `cmd/system/main.go` ä¸­æ³¨å†Œ

### å‰ç«¯å¼€å‘

1. **åˆ›å»ºç±»å‹**ï¼š`frontend/src/typings/api/your-feature.d.ts`
2. **åˆ›å»º API**ï¼š`frontend/src/service/api/your-feature.ts`
3. **åˆ›å»ºé¡µé¢**ï¼š`frontend/src/views/system/your-feature/index.vue`

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ—¥å¿—æŸ¥è¯¢ä¼˜åŒ–

- ä½¿ç”¨ç´¢å¼•å­—æ®µè¿›è¡Œç­›é€‰ï¼ˆuser_id, created_atï¼‰
- é™åˆ¶æ—¶é—´èŒƒå›´ï¼ˆé¿å…å…¨è¡¨æ‰«æï¼‰
- ä½¿ç”¨åˆ†é¡µï¼ˆé¿å…ä¸€æ¬¡åŠ è½½è¿‡å¤šæ•°æ®ï¼‰

### 2. ç»Ÿè®¡åˆ†æä¼˜åŒ–

- é€‰æ‹©åˆé€‚çš„æ—¶é—´èŒƒå›´ï¼ˆæ¨è7å¤©å†…ï¼‰
- ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤æŸ¥è¯¢
- å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

### 3. å®‰å…¨å»ºè®®

- æ•æ„Ÿæ•°æ®è„±æ•ï¼ˆå¯†ç ã€Tokenç­‰ï¼‰
- é™åˆ¶æŸ¥è¯¢æƒé™ï¼ˆæ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ—¥å¿—ï¼‰
- å®šæœŸå¤‡ä»½æ—¥å¿—æ•°æ®

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [System æœåŠ¡ README](../app/system/README.md)
- [æ“ä½œæ—¥å¿—ä¸­é—´ä»¶ä½¿ç”¨æŒ‡å—](./æ“ä½œæ—¥å¿—ä¸­é—´ä»¶ä½¿ç”¨æŒ‡å—.md)
- [ç§Ÿæˆ·æ•°æ®åº“éš”ç¦»æ–¹æ¡ˆ](./æ•°æ®åº“çº§åˆ«ç§Ÿæˆ·éš”ç¦»æ”¹é€ æ–¹æ¡ˆ.md)

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. æœåŠ¡æ—¥å¿—ï¼š`./bin/system.exe` çš„è¾“å‡º
2. MongoDB æ—¥å¿—ï¼šæ£€æŸ¥æ•°æ®åº“è¿æ¥
3. Consul æ—¥å¿—ï¼šæ£€æŸ¥æœåŠ¡æ³¨å†ŒçŠ¶æ€
4. ç½‘å…³æ—¥å¿—ï¼šæ£€æŸ¥è·¯ç”±é…ç½®

---

**ç‰ˆæœ¬**ï¼šv1.0.0  
**æ›´æ–°æ—¶é—´**ï¼š2024-01-01  
**ç»´æŠ¤è€…**ï¼šMule-Cloud å¼€å‘å›¢é˜Ÿ

