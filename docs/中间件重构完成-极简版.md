# ä¸­é—´ä»¶é‡æ„å®Œæˆ - æç®€ç‰ˆ âœ…

## ğŸ¯ é‡æ„ç›®æ ‡

**ä¸€ä¸ªå‡½æ•°æå®šæ‰€æœ‰åœºæ™¯ï¼Œä¸è¦4ä¸ªä¸åŒçš„å‡½æ•°ï¼**

---

## âœ… å®Œæˆ

### æ ¸å¿ƒå‡½æ•°

**`core/middleware/apply.go`** âœ…
```go
middleware.Apply(group, jwtManager)  // ä¸€è¡Œæå®š âœ…
```

---

## ğŸ“Š æ•ˆæœ

### ä¹‹å‰ï¼ˆâŒ å¤æ‚ï¼‰

```go
middleware.ApplyCommonMiddlewares(...)           // åœºæ™¯1
middleware.ApplyGatewayOrJWTMiddlewares(...)     // åœºæ™¯2
middleware.ApplyAdminMiddlewares(...)            // åœºæ™¯3
middleware.ApplyOptionalAuthMiddlewares(...)     // åœºæ™¯4
// ğŸ˜µ éœ€è¦è®°ä½4ä¸ªå‡½æ•°ï¼Œå‚»å‚»åˆ†ä¸æ¸…
```

### ç°åœ¨ï¼ˆâœ… ç®€å•ï¼‰

```go
// 99% çš„åœºæ™¯
middleware.Apply(group, jwtManager)

// 1% çš„ç‰¹æ®Šåœºæ™¯
middleware.Apply(group, jwtManager, middleware.MiddlewareConfig{
    RequireRole: []string{"super"},
})
```

---

## ğŸš€ æ‰€æœ‰æœåŠ¡ç»Ÿä¸€

### auth æœåŠ¡
```go
protected := r.Group("/auth")
middleware.Apply(protected, jwtManager) âœ…
```

### basic æœåŠ¡
```go
basic := r.Group("/basic")
middleware.Apply(basic, jwtManager) âœ…
```

### system æœåŠ¡
```go
system := r.Group("/system")
middleware.Apply(system, jwtManager) âœ…
```

---

## ğŸ“ é…ç½®è¯´æ˜

```go
type MiddlewareConfig struct {
    SupportGateway bool      // æ˜¯å¦æ”¯æŒç½‘å…³ï¼ˆé»˜è®¤: trueï¼‰
    RequireRole    []string  // è¦æ±‚çš„è§’è‰²ï¼ˆé»˜è®¤: nilï¼‰
    Optional       bool      // æ˜¯å¦å¯é€‰è®¤è¯ï¼ˆé»˜è®¤: falseï¼‰
}
```

### é»˜è®¤é…ç½®ï¼ˆä¸ä¼ é…ç½®æ—¶ï¼‰

```go
{
    SupportGateway: true,   // æ”¯æŒç½‘å…³å’Œç›´æ¥è®¿é—®
    RequireRole:    nil,    // ä¸è¦æ±‚ç‰¹å®šè§’è‰²
    Optional:       false,  // å¿…é¡»è®¤è¯
}
```

**è¿™å°±æ˜¯æœ€å¸¸ç”¨çš„é…ç½®ï¼è¦†ç›–99%çš„åœºæ™¯ï¼**

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ ‡å‡†ä¸šåŠ¡ï¼ˆ90%+ï¼‰
```go
middleware.Apply(api, jwtManager)
```

### åœºæ™¯2ï¼šè¦æ±‚ç®¡ç†å‘˜ï¼ˆ5%ï¼‰
```go
middleware.Apply(admin, jwtManager, middleware.MiddlewareConfig{
    RequireRole: []string{"super"},
})
```

### åœºæ™¯3ï¼šå¯é€‰è®¤è¯ï¼ˆ3%ï¼‰
```go
middleware.Apply(public, jwtManager, middleware.MiddlewareConfig{
    Optional: true,
})
```

### åœºæ™¯4ï¼šå…¶ä»–ï¼ˆ2%ï¼‰
```go
middleware.Apply(api, jwtManager, middleware.MiddlewareConfig{
    SupportGateway: false,
    RequireRole:    []string{"admin"},
})
```

---

## ğŸ“¦ æ–°å»ºå¾®æœåŠ¡

```go
import "mule-cloud/core/middleware"

func main() {
    jwtManager := jwt.NewJWTManager(nil, 0)
    
    api := r.Group("/api")
    middleware.Apply(api, jwtManager)  // âœ… å°±è¿™ä¸€è¡Œ
    {
        api.GET("/resources", handler)
    }
}
```

**ä¸éœ€è¦**ï¼š
- âŒ è®°å¿†4ä¸ªå‡½æ•°å
- âŒ çº ç»“ç”¨å“ªä¸ª
- âŒ å†™60è¡Œè®¤è¯ä»£ç 

**è‡ªåŠ¨è·å¾—**ï¼š
- âœ… ç½‘å…³è½¬å‘æ”¯æŒ
- âœ… JWT token éªŒè¯
- âœ… ç§Ÿæˆ·æ•°æ®åº“éš”ç¦»
- âœ… ç³»ç»Ÿç®¡ç†å‘˜åˆ‡æ¢ç§Ÿæˆ·

---

## ğŸ‰ æ€»ç»“

**ä»4ä¸ªå‡½æ•°ç®€åŒ–åˆ°1ä¸ªå‡½æ•°ï¼**

```go
middleware.Apply(group, jwtManager) âœ…
```

**ä¸€ä¸ªå‡½æ•°ï¼Œæå®šæ‰€æœ‰ï¼** ğŸš€

---

## ğŸ“š æ–‡æ¡£

è¯¦è§ï¼š`docs/ä¸­é—´ä»¶æç®€ä½¿ç”¨æŒ‡å—.md`
